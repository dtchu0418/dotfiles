(self.webpackChunk=self.webpackChunk||[]).push([[637],{12989:(e,t,i)=>{i.d(t,{G:()=>o});var s=i(23239),n=i(5114),r=i(4292);class o extends r.J{constructor(){super(),this._popoverActionsHandler=s.h.create(n.YP)}setPopoverActionsHandler(e){this._popoverActionsHandler.set(n.G(e))}get popoverActionsHandlerAtom(){return this._popoverActionsHandler}}},517:(e,t,i)=>{i.d(t,{z:()=>r});var s=i(5114),n=i(23239);class r{constructor(){this.activePopoverStack=n.h.create(s.YP),this.activePopoverView=n.h.create(s.YP),this._popoverActionsHandler=n.h.create(s.YP)}addPopover(e,t){}getInteractionActions(e,t,i){return[]}removePopover(e,t){}switchView(e){}get popoverActionsHandlerAtom(){return this._popoverActionsHandler}setPopoverActionsHandler(e){}}},65586:(e,t,i)=>{i.r(t),i.d(t,{createSduiBasicEngine:()=>C,default:()=>w});var s=i(5114),n=i(21038),r=i(24055),o=i(12054),a=i(12052),d=i(31903),c=i(9922),l=i(85985),p=i(77176),u=i(80358),h=i(84966),v=i(57050),A=i(86782),g=i(12989),m=i(517);const C=({sduiBufferService:e,alertState:t,getByRawAlertId:i,sendUserAction:C,environment:w,capiClient:I,getGrammarlyGoAssistantMode:f,integrationName:P,alertCounts:S,charsCount:G,sduiPopoversSupported:b=!1})=>{const _=new c.w.Keeper,y=(0,v.ls)((e=>e.toString()),i,s.ij,s.UI((e=>n.j.AlertId.from(e.id)))),x=e.capiEvents.pipe(l.h(u.h.is("sdui_add","sdui_remove","sdui_update")),l.h(r.e.isSduiEvent),p.U(o.al.fromSource(o.i5.CAPI))),M=b?new g.G:new m.z,E=new a.G(x,y,M),U=new d.Q({sendUserAction:C}),k=new A.U(E,U,w,I,{openAssistant(e){throw new Error("Method is not implemented")},closePopover:t=>e.pushCapiSduiEvent({kind:"sdui_remove",sduiRootId:h.t_.Id.create(t)})},f,P,S,G);return M.setPopoverActionsHandler(k),_.push(t.subscribe((e=>E.notifyAlertsChanged())),e.capiEvents.pipe(l.h(u.h.is("session_started")),l.h((e=>e.isNewSession))).subscribe((e=>E.onSessionStarted())),e.capiEvents.pipe(l.h(u.h.is("finish")),l.h((e=>0===e.revision))).subscribe((e=>E.onFirstCheckingFinished())),E),{sduiBufferService:e,sduiManager:E,sduiFeedbackService:U,dispose:()=>{_.dispose()}}},w={createSduiBasicEngine:C}},86782:(e,t,i)=>{i.d(t,{U:()=>R});var s=i(23239),n=i(72812),r=i(14454),o=i(57757),a=i(5114),d=i(31668),c=i(83078),l=i(22232),p=i(71249),u=i(73975),h=i(32952),v=i(9922),A=i(41398),g=i(77176),m=i(93508),C=i(19751),w=i(66268),I=i(57050),f=i(26328),P=i(85441),S=i(8901),G=i(40151),b=i(95195),_=i(8125);class y{constructor(){this.feed=G.E,this.currentFeed=a.YP,this.onFeedRemove=G.E,this.onFeedEmpty=G.E,this.header=G.E,this.footer=G.E,this.pushFeed=()=>b.right(null),this.popFeed=_.Q1,this.focusCard=()=>b.right(null),this.notifyCardFocused=_.Q1,this.dispose=_.Q1}}var x,M=i(33194),E=i(9205),U=i(39040),k=i(32260),F=i(69627),z=i(46728),T=i(6859),H=i(31528);class R{constructor(e,t,i,r,o,d,c,l,p){this.sduiManager=e,this.sduiFeedbackService=t,this.environment=i,this.capiClient=r,this.integrationModel=o,this.getGrammarlyGoAssistantMode=d,this.integrationName=c,this.alertCounts=l,this.charsCount=p,this._focusedItem=s.h.create(a.YP),this._sduiInlineCardActions=new h.xQ,this._subs=new v.w.Keeper,this.focusCard=e=>{this._focusedItem.set(a.G(e))},this.handleSduiCardAction=(e,t,i)=>{this._sduiInlineCardActions.next({cardAction:e,cardModel:t,match:i})},this.handleGButtonPopoverAction=e=>{this._sduiViewModel.sduiActionEvents.next(e),(0,I.zG)(R.getSduiFeedActions(e.actions),a.UI((t=>this.integrationModel.openAssistant({type:H.WT.sdui,action:{...e,actions:t,type:w.lY.Type.sduiCardAction}}))))},this.trackInlineAlertApplyDuration=(e,t)=>{if(!(0,P.OB)().experimentClient.isGateEnabled(E.K.TrackInlineAlertApplyMetric))return;const i="inlineAlertApply",s=e,n={...(0,T.fN)(),alertCategory:t.category,alertGroup:t.group,integrationName:(0,T.xg)(this.integrationName),unmutedCapiAlertCount:(0,T._K)(this.alertCounts.get().unmutedCapiAlerts),visibleInlineCapiAlertCount:(0,T._K)(this.alertCounts.get().visibleInlineCapiAlerts),textLength:(0,T.RA)(this.charsCount.get())};z.T.endMeasure(i,s,"histogram",n),z.T.sendMeasures([{metricName:i,id:s}])},this.dispose=()=>this._subs.dispose(),this._sduiViewModel=new n.x(t,e,new y,r,this._focusedItem.view(a.UI((e=>e.id))));const u=this._sduiViewModel.sduiActionEvents.pipe(A.M(this._sduiInlineCardActions.pipe(g.U(a.G),m.O(a.YP)))).subscribe((([e,t])=>this._nativeHandling(e,(0,I.zG)(t,a.UI((e=>e.match))),(0,I.zG)(t,a.UI((e=>e.cardModel)))))),f=this._sduiInlineCardActions.pipe(C.skipBy(x.eq)).subscribe((({cardAction:e})=>this._sduiViewModel.sduiActionEvents.next(e)));this._subs.push(u,f,this._sduiViewModel)}_nativeHandling({actions:e,cardId:t,sourceId:i,scope:s},n,r){(0,I.zG)(R.getSduiFeedActions(e),a.UI((e=>{(0,I.zG)(r,a.UI((n=>{n.onOpenExpandedViewBySduiAction(M.Oe.create(e,t,i,s))})))}))),e.forEach((e=>{switch(e.type){case"nextCard":case"prevCard":case"openSettings":case"openToneDetector":case"openFeedback":case"openLearnMore":case"transition":case"openCreateSnippetModal":case"nativeOpenAssistant":case"selectAlternative":case"highlightAlert":case"openPerformanceScore":case"nativeOpenUserSatisfactionFeedback":case"enablePlagiarismCheck":case"disablePlagiarismCheck":case"showHighlights":case"hideHighlights":case"notify":case"switchView":case"newRevision":case"interactPopover":case"enableWritingExpertCheck":case"disableWritingExpertCheck":case"pushAssistantFeed":case"popAssistantFeed":case"focusAssistantCard":return;case"closePopover":return void this.integrationModel.closePopover(e.rootPopoverId);case"openLink":return void this.environment.actions.openPopup(new d.Z(e.url));case"copyToClipboard":return void(0,o.vQ)(e.text);case"stopApplyingAlerts":case"upgradeToPremium":return(0,I.zG)(r,a.UI((e=>e.openPlanComparisonPage({utmCampaign:S.L.Place.assistantCardList})))),void(0,I.zG)(n,a.UI((e=>e.hide())));case"applyAlerts":return void(0,I.zG)(n,a.UI((i=>{if(null==i.alert)return;const{alert:s}=i;(0,I.zG)((0,U.UQ)(s,i.plainText),(t=>new k.U_(t,(t=>i.replace(null!=t?t:"",!1,e.alternativeIndex)))),(i=>(0,I.zG)(a.ij(i.replacements[e.alternativeIndex]),a.UI((e=>i.getOnReplace(e)())),c.bw((()=>{this.trackInlineAlertApplyDuration(t,s)}))))),i.hide()})));case"closeCard":case"removeRoot":return void(0,I.zG)(n,a.UI((e=>e.hide())));case"removeAlerts":return void(0,I.zG)(n,a.UI((e=>{e.ignore(),e.hide()})));case"openGrammarlyGo":return void(0,I.zG)(a.RD([r,n]),a.UI((([e,t])=>{var i,s;const n=(t,i)=>{const s=this.getGrammarlyGoAssistantMode();e.onOpenGrammarlyGo({assistantMode:s,genAIParams:t,source:i})};if(t.alert&&(0,F.t)(t.alert.patternName)){const e=(0,U.UQ)(t.alert,t.plainText);if(e.length>0&&e[0].newText){const i=e[0].newText;n({genAISessionMode:"pushRewrite",writingExpertContext:{alertId:t.alert.id,alertPname:t.alert.patternName,originalText:t.alert.text,replacementText:i},transformRange:t.alert.transformRange},{kind:"inlinePushRewriteSource"})}else n({genAISessionMode:"ideation"},{kind:"inlinePushRewriteSource"})}else n({genAISessionMode:"ideation"},{kind:"inlineCardSource",alertId:null!==(s=null===(i=t.alert)||void 0===i?void 0:i.id)&&void 0!==s?s:null})})));default:(0,l.L0)(e)}}))}}R.getSduiFeedActions=(0,I.ls)(p.hX((e=>"popAssistantFeed"===e.type||"pushAssistantFeed"===e.type||"focusAssistantCard"===e.type)),f.nI),function(e){e.eq=u.MW({cardAction:r.t.eq})}(x||(x={}))},57757:(e,t,i)=>{i.d(t,{Sz:()=>r,vQ:()=>n});var s=i(95195);async function n(e,t=self){if(function(e=self){var t,i;return!!(null===(i=null===(t=e.navigator)||void 0===t?void 0:t.clipboard)||void 0===i?void 0:i.writeText)}(t))return t.navigator.clipboard.writeText(e);throw new Error("Clipboard API not supported")}function r(e,t=self){return n(e,t).then((()=>s.right(void 0))).catch((e=>s.left(e instanceof Error?e:new Error(String(e)))))}}}]);