(self.webpackChunk=self.webpackChunk||[]).push([[5275],{12989:(e,t,n)=>{n.d(t,{G:()=>a});var i=n(23239),r=n(5114),s=n(4292);class a extends s.J{constructor(){super(),this._popoverActionsHandler=i.h.create(r.YP)}setPopoverActionsHandler(e){this._popoverActionsHandler.set(r.G(e))}get popoverActionsHandlerAtom(){return this._popoverActionsHandler}}},517:(e,t,n)=>{n.d(t,{z:()=>s});var i=n(5114),r=n(23239);class s{constructor(){this.activePopoverStack=r.h.create(i.YP),this.activePopoverView=r.h.create(i.YP),this._popoverActionsHandler=r.h.create(i.YP)}addPopover(e,t){}getInteractionActions(e,t,n){return[]}removePopover(e,t){}switchView(e){}get popoverActionsHandlerAtom(){return this._popoverActionsHandler}setPopoverActionsHandler(e){}}},86782:(e,t,n)=>{n.d(t,{U:()=>R});var i=n(23239),r=n(72812),s=n(14454),a=n(57757),o=n(5114),c=n(31668),d=n(83078),l=n(22232),u=n(71249),p=n(73975),h=n(32952),v=n(9922),f=n(41398),g=n(77176),A=n(93508),m=n(19751),I=n(66268),C=n(57050),w=n(26328),b=n(85441),y=n(8901),S=n(40151),_=n(95195),P=n(8125);class G{constructor(){this.feed=S.E,this.currentFeed=o.YP,this.onFeedRemove=S.E,this.onFeedEmpty=S.E,this.header=S.E,this.footer=S.E,this.pushFeed=()=>_.right(null),this.popFeed=P.Q1,this.focusCard=()=>_.right(null),this.notifyCardFocused=P.Q1,this.dispose=P.Q1}}var M,E=n(33194),U=n(9205),k=n(39040),x=n(32260),F=n(69627),T=n(46728),z=n(6859),H=n(31528);class R{constructor(e,t,n,s,a,c,d,l,u){this.sduiManager=e,this.sduiFeedbackService=t,this.environment=n,this.capiClient=s,this.integrationModel=a,this.getGrammarlyGoAssistantMode=c,this.integrationName=d,this.alertCounts=l,this.charsCount=u,this._focusedItem=i.h.create(o.YP),this._sduiInlineCardActions=new h.xQ,this._subs=new v.w.Keeper,this.focusCard=e=>{this._focusedItem.set(o.G(e))},this.handleSduiCardAction=(e,t,n)=>{this._sduiInlineCardActions.next({cardAction:e,cardModel:t,match:n})},this.handleGButtonPopoverAction=e=>{this._sduiViewModel.sduiActionEvents.next(e),(0,C.zG)(R.getSduiFeedActions(e.actions),o.UI((t=>this.integrationModel.openAssistant({type:H.WT.sdui,action:{...e,actions:t,type:I.lY.Type.sduiCardAction}}))))},this.trackInlineAlertApplyDuration=(e,t)=>{if(!(0,b.OB)().experimentClient.isGateEnabled(U.K.TrackInlineAlertApplyMetric))return;const n="inlineAlertApply",i=e,r={...(0,z.fN)(),alertCategory:t.category,alertGroup:t.group,integrationName:(0,z.xg)(this.integrationName),unmutedCapiAlertCount:(0,z._K)(this.alertCounts.get().unmutedCapiAlerts),visibleInlineCapiAlertCount:(0,z._K)(this.alertCounts.get().visibleInlineCapiAlerts),textLength:(0,z.RA)(this.charsCount.get())};T.T.endMeasure(n,i,"histogram",r),T.T.sendMeasures([{metricName:n,id:i}])},this.dispose=()=>this._subs.dispose(),this._sduiViewModel=new r.x(t,e,new G,s,this._focusedItem.view(o.UI((e=>e.id))));const p=this._sduiViewModel.sduiActionEvents.pipe(f.M(this._sduiInlineCardActions.pipe(g.U(o.G),A.O(o.YP)))).subscribe((([e,t])=>this._nativeHandling(e,(0,C.zG)(t,o.UI((e=>e.match))),(0,C.zG)(t,o.UI((e=>e.cardModel)))))),w=this._sduiInlineCardActions.pipe(m.skipBy(M.eq)).subscribe((({cardAction:e})=>this._sduiViewModel.sduiActionEvents.next(e)));this._subs.push(p,w,this._sduiViewModel)}_nativeHandling({actions:e,cardId:t,sourceId:n,scope:i},r,s){(0,C.zG)(R.getSduiFeedActions(e),o.UI((e=>{(0,C.zG)(s,o.UI((r=>{r.onOpenExpandedViewBySduiAction(E.Oe.create(e,t,n,i))})))}))),e.forEach((e=>{switch(e.type){case"nextCard":case"prevCard":case"openSettings":case"openToneDetector":case"openFeedback":case"openLearnMore":case"transition":case"openCreateSnippetModal":case"nativeOpenAssistant":case"selectAlternative":case"highlightAlert":case"openPerformanceScore":case"nativeOpenUserSatisfactionFeedback":case"enablePlagiarismCheck":case"disablePlagiarismCheck":case"showHighlights":case"hideHighlights":case"notify":case"switchView":case"newRevision":case"interactPopover":case"enableWritingExpertCheck":case"disableWritingExpertCheck":case"pushAssistantFeed":case"popAssistantFeed":case"focusAssistantCard":return;case"closePopover":return void this.integrationModel.closePopover(e.rootPopoverId);case"openLink":return void this.environment.actions.openPopup(new c.Z(e.url));case"copyToClipboard":return void(0,a.vQ)(e.text);case"stopApplyingAlerts":case"upgradeToPremium":return(0,C.zG)(s,o.UI((e=>e.openPlanComparisonPage({utmCampaign:y.L.Place.assistantCardList})))),void(0,C.zG)(r,o.UI((e=>e.hide())));case"applyAlerts":return void(0,C.zG)(r,o.UI((n=>{if(null==n.alert)return;const{alert:i}=n;(0,C.zG)((0,k.UQ)(i,n.plainText),(t=>new x.U_(t,(t=>n.replace(null!=t?t:"",!1,e.alternativeIndex)))),(n=>(0,C.zG)(o.ij(n.replacements[e.alternativeIndex]),o.UI((e=>n.getOnReplace(e)())),d.bw((()=>{this.trackInlineAlertApplyDuration(t,i)}))))),n.hide()})));case"closeCard":case"removeRoot":return void(0,C.zG)(r,o.UI((e=>e.hide())));case"removeAlerts":return void(0,C.zG)(r,o.UI((e=>{e.ignore(),e.hide()})));case"openGrammarlyGo":return void(0,C.zG)(o.RD([s,r]),o.UI((([e,t])=>{var n,i;const r=(t,n)=>{const i=this.getGrammarlyGoAssistantMode();e.onOpenGrammarlyGo({assistantMode:i,genAIParams:t,source:n})};if(t.alert&&(0,F.t)(t.alert.patternName)){const e=(0,k.UQ)(t.alert,t.plainText);if(e.length>0&&e[0].newText){const n=e[0].newText;r({genAISessionMode:"pushRewrite",writingExpertContext:{alertId:t.alert.id,alertPname:t.alert.patternName,originalText:t.alert.text,replacementText:n},transformRange:t.alert.transformRange},{kind:"inlinePushRewriteSource"})}else r({genAISessionMode:"ideation"},{kind:"inlinePushRewriteSource"})}else r({genAISessionMode:"ideation"},{kind:"inlineCardSource",alertId:null!==(i=null===(n=t.alert)||void 0===n?void 0:n.id)&&void 0!==i?i:null})})));default:(0,l.L0)(e)}}))}}R.getSduiFeedActions=(0,C.ls)(u.hX((e=>"popAssistantFeed"===e.type||"pushAssistantFeed"===e.type||"focusAssistantCard"===e.type)),w.nI),function(e){e.eq=p.MW({cardAction:s.t.eq})}(M||(M={}))},17232:(e,t,n)=>{n.r(t),n.d(t,{createSduiInlineEngine:()=>x,default:()=>F});var i=n(5114),r=n(21038),s=n(40330),a=n(24055),o=n(12054),c=n(12052),d=n(42040),l=n(46680),u=n(26393),p=n(92843),h=n(9922),v=n(93508),f=n(16118),g=n(77176),A=n(28811),m=n(57050);function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function C(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,s=[],a=!0,o=!1;try{for(n=n.call(e);!(a=(i=n.next()).done)&&(s.push(i.value),!t||s.length!==t);a=!0);}catch(e){o=!0,r=e}finally{try{a||null==n.return||n.return()}finally{if(o)throw r}}return s}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return I(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var y=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),w(this,"_state",new Map),w(this,"_subs",new h.w.Keeper),w(this,"_log",d.C8.Logging.getLogger("SDUIInlineManager",l.i.TRACE,l.T.Manager.getColor())),this._subs.push(t.pipe(v.O(A.a.empty),f.G(),g.U((function(e){var t=b(e,2),n=t[0],i=t[1];return A.a.diff(n,i)})),g.U((function(e){return n._processSDUIItems(e)}))).subscribe())}var t,n,r;return t=e,(n=[{key:"getInlineItemForAlert",value:function(e){return i.ij(this._state.get(e))}},{key:"_processSDUIItems",value:function(e){var t=this;(0,m.zG)(e,p.v.forEach((function(e){S(e)&&(t._log.trace("inline item removed",{alertIds:e.alertIds,itemId:e.id}),e.alertIds.forEach((function(e){return t._state.delete(e)})))}),(function(e,n){S(n)&&(t._log.trace("inline item updated",{alertIds:n.alertIds,itemId:n.id}),n.alertIds.forEach((function(e){return t._state.set(e,n)})))}),(function(e){S(e)&&(t._log.trace("inline item added",{alertIds:e.alertIds,itemId:e.id}),e.alertIds.forEach((function(n){return t._state.set(n,e)})))})))}},{key:"dispose",value:function(){this._subs.dispose()}}])&&C(t.prototype,n),r&&C(t,r),e}(),S=function(e){return(0,m.zG)(u.ab.findFirst(e.content,"inlineCard"),i.pC)},_=n(31903),P=n(85985),G=n(80358),M=n(33194),E=n(86782),U=n(12989),k=n(517);const x=({sduiBufferService:e,alertState:t,getByRawAlertId:n,sendUserAction:d,environment:l,capiClient:u,integrationModel:p,getGrammarlyGoAssistantMode:v,integrationName:f,alertCounts:A,charsCount:I,sduiPopoversSupported:C=!1})=>{const w=new h.w.Keeper,b=(0,m.ls)((e=>e.toString()),n,i.ij,i.UI((e=>r.j.AlertId.from(e.id)))),S=e.capiEvents.pipe(P.h(G.h.is("sdui_add","sdui_remove","sdui_update")),P.h((e=>"sdui_remove"===e.kind||M.D1.InlineCard.isInlineCard(e.sdui)||M.D1.StrongAlertRef.isStrongAlertRefUpgradeHookContent(e.sdui)||M.D1.GButton.isGButtonContent(e.sdui)||M.D1.PopoverStack.isPopoverStack(e.sdui)||s.vK.isGlobalPart(e.sdui))),P.h(a.e.isSduiEvent),g.U(o.al.fromSource(o.i5.CAPI))),x=C?new U.G:new k.z,F=new c.G(S,b,x),T=new y(F.state),z=new _.Q({sendUserAction:d}),H=new E.U(F,z,l,u,p,v,f,A,I);return x.setPopoverActionsHandler(H),w.push(t.subscribe((e=>F.notifyAlertsChanged())),e.capiEvents.pipe(P.h(G.h.is("session_started")),P.h((e=>e.isNewSession))).subscribe((e=>F.onSessionStarted())),e.capiEvents.pipe(P.h(G.h.is("finish")),P.h((e=>0===e.revision))).subscribe((e=>F.onFirstCheckingFinished())),F,T,H),{sduiBufferService:e,sduiManager:F,sduiInlineManager:T,sduiFeedbackService:z,inlineCardViewModel:H,dispose:()=>{w.dispose()}}},F={createSduiInlineEngine:x}},57757:(e,t,n)=>{n.d(t,{Sz:()=>s,vQ:()=>r});var i=n(95195);async function r(e,t=self){if(function(e=self){var t,n;return!!(null===(n=null===(t=e.navigator)||void 0===t?void 0:t.clipboard)||void 0===n?void 0:n.writeText)}(t))return t.navigator.clipboard.writeText(e);throw new Error("Clipboard API not supported")}function s(e,t=self){return r(e,t).then((()=>i.right(void 0))).catch((e=>i.left(e instanceof Error?e:new Error(String(e)))))}}}]);