(self.webpackChunk=self.webpackChunk||[]).push([[274],{25878:(e,i,t)=>{t.r(i),t.d(i,{G2FeatureImpl:()=>Ge});var r=t(27378),a=t(14601),n=t(77176),s=t(98403),l=t(23239),d=t(57050),o=t(20236),c=t(55649);const h=r.lazy((()=>Promise.all([t.e(2251),t.e(6669),t.e(4352),t.e(274)]).then(t.bind(t,10180)).then((({ParagraphHighlightCollection:e})=>({default:e}))))),g=r.lazy((()=>Promise.all([t.e(2251),t.e(6669),t.e(4352),t.e(274)]).then(t.bind(t,58876)).then((({SidelineCollection:e})=>({default:e})))));var p=t(32952),u=t(2844),m=t(24209),w=t(49708),f=t(2834),v=t(66310),_=t(19751),C=t(85985),b=t(23063),S=t(17343),y=t(97425),R=t(76974),x=t(5114),I=t(48015);var E=t(36991);function F(e){return e.trim().split(/\s+/).filter((e=>""!==e)).length}function T(e,i){return e.map((e=>function(e,i){return(0,d.zG)(e.transformJSON.alternatives,x.UI((({alternatives:e,context:i})=>({alternative:e[0],context:i[0]}))),x.UI((({alternative:e,context:i})=>({ops:e.ops,context:i}))),x.UI((({ops:t,context:r})=>{let a=r.s,n=0;for(const e of t)E.s.match((e=>{E.s.isInsertString(e)&&(n+=F(e.insert),a+=e.insert.length)}),(e=>{const t=a+e.delete;n+=F(i.slice(a,t)),a=t}),(e=>{a+=e.retain}))(e);return n*((s=e.patternName).includes("MissingSpace")||s.includes("RedundantSpace")||s.includes("Clarity")||s.includes("Punctuation")?.5:s.includes("Formatting")||s.includes("Passive")||s.includes("Dialects")?.25:s.includes("Calliope")?.75:s.includes("Tone")||s.includes("Engagement")?.1:s.includes("RunOn")?2:s.includes("Style")?.5:s.includes("Fluency")||s.includes("FluencyRewrite")?.25:1);var s})),x.fS((()=>0)))}(e,i))).reduce(((e,i)=>e+i),0)}function k(e,i,t){if(e.text.length<50)return x.YP;const r=function(e,i){return e.filter((e=>e.transformJSON.highlights.some((e=>e.s>=i.start&&e.e<=i.end))))}(i,e.textRange);if(r.some((e=>e.patternName.startsWith("WritingExpert"))))return x.G("writingCoach");const a=T(r.filter((e=>!e.patternName.startsWith("WritingExpert"))),t),n=(s=e.text,Math.max(5,Math.min(10,F(s)/10)));var s;return Math.round(a)>=n?x.G("attention"):x.YP}var M=t(49276);class L{constructor(e){this._params=e,this._subs=new a.w,this._logger=c.Y.create("SidelineCollectionViewModelImpl"),this._sidelines=l.h.create([]),this._sidelineById=new Map,this._emphasizedSideline=l.h.create(x.YP),this._activeSideline=l.h.create(x.YP),this._pinnedSideline=l.h.create(x.YP),this._shouldHideSidelines=l.h.create(!1),this._referenceElementBySidelineId=new Map,this._sidelineCardActiveNotifications=new p.xQ,this._deactivateSidelineSubs=new a.w,this._unpinSidelineSubs=new a.w,this.sidelines=this._sidelines.view(),this.emphasizedSideline=this._emphasizedSideline.view(),this.activeSideline=this._activeSideline.view(),this.pinnedSideline=this._pinnedSideline.view(),this.shouldHideSidelines=this._shouldHideSidelines.view(),this._subs.add(u.aj([this._params.paragraphHighlightCollectionViewModel.paragraphHighlights,this._params.alerts]).pipe(n.U((([e,i])=>e.map((e=>{if(!e.isScrolledIntoView)return null;const t=(0,d.zG)(this._params.paragraphCollectionService.getParagraphById(e.paragraphId),x.g_((()=>null),(t=>function(e,i,t,r){const a=`g2-sideline-${e.textRange.start}-${e.textRange.end}`,n=k(e,t,r);return{id:a,paragraphId:e.id,paragraphHighlightViewportRect:{top:i.viewportRect.top,left:i.viewportRect.left,width:i.viewportRect.width,height:i.viewportRect.height},signal:n}}(t,e,i,this._params.textObserver.getCurrentTextMap().getPlainText()))));return null===t?(this._logger.warn("Failed to create sideline for paragraph; skipping.",{paragraphId:e.paragraphId}),null):t})).filter(I.Nf)))).subscribe(s.wW(this._sidelines))),this._subs.add(u.aj([this.sidelines,this._params.paragraphHighlightCollectionViewModel.emphasizedParagraphHighlight]).pipe(n.U((([e,i])=>(0,d.zG)(i,x.tS((i=>x.ij(e.find((e=>e.paragraphId===i.paragraphId))))))))).subscribe(s.wW(this._emphasizedSideline))),this._subs.add(this._sidelines.subscribe((e=>{this._sidelineById.clear();for(const i of e)this._sidelineById.set(i.id,i)}))),this._subs.add(m.T(this._params.textFieldLayout.scroll.changes,w.R((0,M.Jj)(this._params.textFieldElement),"scroll",{capture:!0})).pipe(f.b((()=>this._shouldHideSidelines.set(!0))),v.w((()=>_.timer(1e3).pipe(f.b((()=>this._shouldHideSidelines.set(!1))))))).subscribe())}_doesSidelineIdMatchRelevantSideline(e,i){return(0,d.zG)(i,x.g_((()=>!1),(i=>e===i.id)))}_getSidelineById(e){return x.ij(this._sidelineById.get(e))}_deactivateSideline(e,i=!1){this._logger.debug("Deactivating sideline.",{sidelineId:e}),this._doesSidelineIdMatchRelevantSideline(e,this._activeSideline.get())?this._deactivateSidelineSubs=this._sidelineCardActiveNotifications.pipe(C.h((i=>i===e)),b.q(1),S.h(!1),y.L(i?0:1e3,R.of(!0))).subscribe((i=>{i?(this._logger.debug("Did not receive notification that corresponding sideline card is active, proceeding to deactivate sideline.",{sidelineId:e}),this._activeSideline.set(x.YP)):this._logger.debug("Received a notification that corresponding sideline card is active, won't deactivate sideline.",{sidelineId:e})})):this._logger.warn("Tried to deactivate sideline that is not active, this is a no-op.",{sidelineId:e})}_unpinSideline(e,i=!1){this._logger.debug("Unpinning sideline.",{sidelineId:e}),this._doesSidelineIdMatchRelevantSideline(e,this._pinnedSideline.get())?this._unpinSidelineSubs=this._sidelineCardActiveNotifications.pipe(C.h((i=>i===e)),b.q(1),S.h(!1),y.L(i?0:1e3,R.of(!0))).subscribe((i=>{i?(this._logger.debug("Did not receive notification that corresponding sideline card is active, proceeding to unpin sideline.",{sidelineId:e}),this._pinnedSideline.set(x.YP),this._deactivateSideline(e,!0)):this._logger.debug("Received a notification that corresponding sideline card is active, won't unpin sideline.",{sidelineId:e})})):this._logger.warn("Tried to unpin sideline that is not pinned, this is a no-op.",{sidelineId:e})}activateSideline(e){this._logger.debug("Activating sideline.",{sidelineId:e});const i=this._getSidelineById(e);x.pC(i)?(this._deactivateSidelineSubs.unsubscribe(),this._activeSideline.set(i),this._emphasizedSideline.set(i)):this._logger.warn("Tried to activate non-existing sideline, this is a no-op.",{sidelineId:e})}deactivateSideline(e){this._deactivateSideline(e)}pinSideline(e){this._logger.debug("Pinning sideline.",{sidelineId:e});const i=this._getSidelineById(e);x.pC(i)?(this._pinnedSideline.set(i),this.activateSideline(e)):this._logger.warn("Tried to pin non-existing sideline, this is a no-op.",{sidelineId:e})}unpinSideline(e){this._unpinSideline(e)}setSidelineReferenceElement(e,i){this._referenceElementBySidelineId.set(e,i)}getSidelineReferenceElement(e){return x.ij(this._referenceElementBySidelineId.get(e))}notifySidelineCardActive(e){this._sidelineCardActiveNotifications.next(e)}notifySidelineCardInactive(e,i){this._unpinSideline(e,i),this._deactivateSideline(e,i)}getSidelineById(e){return this._getSidelineById(e)}dispose(){this._subs.unsubscribe(),this._deactivateSidelineSubs.unsubscribe(),this._unpinSidelineSubs.unsubscribe()}}var G=t(7604),B=t(61292),P=t(93508),z=t(46297),N=t(89456),V=t(95652),A=t(35550);class U{constructor(e){this._params=e,this._subs=new a.w,this._logger=c.Y.create("G2IntegrationGoogleDocs"),this._textFieldVisibleRect=l.h.create({top:0,left:0,width:0,height:0}),this._highlightCollectionFilterSource=new A.b(this._params.textObserver),this.name="g2-google-docs-integration",this.textFieldVisibleRect=this._textFieldVisibleRect.view(),this.highlightCollectionGeometryFilter=this._highlightCollectionFilterSource.highlightsFilterFactory(),this._subs.add(u.aj([this._params.textFieldLayout.rect.changes.pipe(P.O(this._params.textFieldLayout.rect.getCurrent())),this._params.textFieldLayout.scroll.changes.pipe(P.O(this._params.textFieldLayout.scroll.getCurrent()))]).pipe(n.U((()=>{var e;const i=this._params.textFieldElement.getBoundingClientRect(),t={top:i.top,left:i.left,width:i.width,height:i.height},r=(0,V.Gg)(this._params.textFieldElement)||(0,V.g)(this._params.textFieldElement)||(0,M.Jj)(this._params.textFieldElement).document.documentElement,a=this._params.textFieldElement.querySelector(z.gv);if(null!==a){const{left:i,width:n}=null!==(e=N.UL.getIntersection(t,a.getBoundingClientRect()))&&void 0!==e?e:t,s=N.UL.getIntersection({...t,left:i,width:n},r.getBoundingClientRect());return null!==s?s:(this._logger.warn("Failed to find intersection between the text field and its first scrollable ancestor. The resulting text field's visible rect may not be appropriate."),{...t,left:i,width:n})}{this._logger.warn("Failed to retrieve rendering canvas. The resulting text field's visible rect lateral boundaries may not be appropriate.");const e=N.UL.getIntersection(t,r.getBoundingClientRect());return null!==e?e:(this._logger.warn("Failed to find intersection between the text field and its first scrollable ancestor. The resulting text field's visible rect may not be appropriate."),t)}}))).subscribe(s.wW(this._textFieldVisibleRect)))}dispose(){this._subs.unsubscribe()}}var H=t(18431);const O={[H.u.gmailCompose]:14,[H.u.gmailReply]:14,[H.u.gmailComposeStandalone]:14,[H.u.gmailComposeFullScreen]:14,[H.u.slackMessage]:2,[H.u.slackGenericQuill]:2,[H.u.slackThread]:2};class D{constructor(e){this._params=e,this._subs=new a.w,this._logger=c.Y.create("G2IntegrationBase"),this._textFieldVisibleRect=l.h.create({top:0,left:0,width:0,height:0}),this.name="g2-base-integration",this.textFieldVisibleRect=this._textFieldVisibleRect.view(),this.highlightCollectionGeometryFilter=G.qH.everything,this._subs.add(u.aj([this._params.textFieldLayout.rect.changes.pipe(P.O(this._params.textFieldLayout.rect.getCurrent())),this._params.textFieldLayout.scroll.changes.pipe(P.O(this._params.textFieldLayout.scroll.getCurrent()))]).pipe(n.U((([e])=>{const i=(0,V.Gg)(this._params.textFieldElement)||(0,V.g)(this._params.textFieldElement)||(0,M.Jj)(this._params.textFieldElement).document.documentElement,t={top:e.client.top,left:e.client.left,...e.size},r=N.UL.getIntersection(t,i.getBoundingClientRect());if(null!==r){const e=this._getLeftOffset();return{...r,left:t.left-e,width:t.width+e}}{this._logger.warn("Failed to find intersection between the text field's layout rect and the text field's first scrollable ancestor. The resulting text field's visible rect may not be appropriate.");const e=this._getLeftOffset();return{...t,left:t.left-e,width:t.width+e}}}))).subscribe(s.wW(this._textFieldVisibleRect)))}_getLeftOffset(){return this._params.integrationName in O?function(e){return O[e]}(this._params.integrationName):(this._logger.debug(`No left offset defined for integration with name "${this._params.integrationName}," defaulting to zero.`),0)}dispose(){this._subs.unsubscribe()}}var Y=t(10389);var W=t(8125),J=t(22232),j=t(95195),$=t(38788),q=t(60797),Q=t(14717),K=t(73915),Z=t(59502),X=t(2344);const ee=K.n(X.l7(Z.Schemable)({sensitiveDelta:Z.id()}))(X.rb).is;function ie(e){return ee(e)&&"disposable_cheetah:resultSuccess"===e.action}function te(e){return ee(e)&&"disposable_cheetah:resultFailure"===e.action}function re(e){return{kind:"predefinedAction",actionIdentifier:{kind:"id",value:e}}}var ae=t(8359);function ne(e){switch(e){case"improve":return re("VBarG2DefaultRewrite");case"calliope":return re("VBarG2Calliope");case"rephrase":return re("VBarG2Paraphrase");case"shorten":return re("VBarG2Shorter");case"friendly":return re("VBarG2Friendly");case"formal":return re("VBarG2Formal");default:(0,J.L0)(e)}}var se=t(69243);const le=se.OT(se.dt({explanation:se.OT(se.Z_)}));var de=t(66347);class oe{constructor(e){this._params=e,this._subs=new a.w,this._logger=c.Y.create("RewriteServiceImpl"),this._relevantCapiMessages=this._params.checkingService.pipe(q.oA,v.w((e=>e.capiMessages)),C.h((0,W.Kg)(ie,te))),this._cachedRewriteIdMap=new Map,this._cachedRewriteMap=new Map,this._subs.add(this._relevantCapiMessages.subscribe((e=>this._handleServerMessage(e))))}_handleServerMessage(e){ie(e)?this._handleServerMessageResultSuccess(e):te(e)?this._handleServerMessageResultFailure(e):(0,J.L0)(e)}_handleServerMessageResultSuccess(e){const i=this._cachedRewriteMap.get(e.correlationId);if(void 0===i)this._logger.warn("Received a successful result with unknown correlation ID.",{resultSuccessMessage:e});else{const t=(0,d.zG)(function(e){if(void 0===e.debugInfoJson)return j.left("Debug info JSON undefined.");try{const i=JSON.parse(e.debugInfoJson);return(0,d.zG)(le.decode(i),j.mapLeft((e=>"Failed to decode debug info JSON."+(e[0].message?`Reason: ${e[0].message}.`:""))))}catch(e){return j.left(`Failed to parse debug info JSON. Reason: ${e}.`)}}(e),j.mapLeft((e=>this._logger.error(`Failed to extract debug info from successful result. Reason: ${e}.`))),x.Uo),r={kind:"ready",id:i.get().id,type:i.get().type,text:i.get().text,textRange:i.get().textRange,title:(0,d.zG)(t,x.UI((e=>e.explanation)),x.pF((()=>{return"improve"===(e=i.get().type)?"Improve your text":"rephrase"===e?"Rephrase your text":"calliope"===e?"Refine your text":"shorten"===e?"Condense wordy sections":"friendly"===e?"Use a friendly tone":"formal"===e?"Use formal language":void(0,J.L0)(e);var e}))),rewriteText:e.rewrittenText,rewriteDelta:e.rewrittenTextDelta,rewriteDiff:(0,d.zG)(de.F.getDiff(i.get().text,e.rewrittenText),j.mapLeft((i=>this._logger.error("Failed to get diff for rewrite.",{error:i,newText:e.rewrittenText}))),x.Uo)};this._logger.debug("Received a successful result; updating rewrite.",{rewriteBefore:i.get(),rewriteAfter:r}),i.set(r)}}_handleServerMessageResultFailure(e){const i=this._cachedRewriteMap.get(e.correlationId);if(void 0===i)this._logger.warn("Received a failed result with unknown correlation ID.",{resultFailureMessage:e});else{const t={kind:"error",id:i.get().id,type:i.get().type,text:i.get().text,textRange:i.get().textRange,errorReason:e.error};this._logger.debug("Received a failed result; updating rewrite.",{rewriteBefore:i.get(),rewriteAfter:t}),i.set(t)}}async getRewrite(e,i,t,r=!0){const a=(0,Q.Wu)(i),n=`${e}-${t.start}-${t.end}-${a}`,s=this._cachedRewriteIdMap.get(n),d=void 0!==s?this._cachedRewriteMap.get(s):void 0,o=r&&void 0!==d&&"error"!==d.get().kind;if(o)return d;o||void 0===s||this._cachedRewriteMap.delete(s);const c=(0,$.Z)();this._cachedRewriteIdMap.set(n,c);const h=l.h.create({kind:"loading",id:c,type:e,text:i,textRange:t});this._cachedRewriteMap.set(h.get().id,h);const g=this._params.checkingService.get();if(x.Wi(g))return this._logger.error("Failed to get rewrite. Checking service not initialized yet."),h.modify((e=>({...e,kind:"error",errorReason:"Failed to communicate with server."}))),h;const p=function(e){return{command:ne(e.type),correlationId:e.id,generationMode:ae.s.Rewrite,textScope:{start:e.textRange.start,end:e.textRange.end},debugInfoJson:JSON.stringify({trackBackendTimings:!0}),meta:{trustResult:!0}}}(h.get());try{const e=await g.value.sendMessage("disposable_cheetah:invokeCommand",p,!0,!1)();if(j.isLeft(e))throw e.left.message;return h}catch(e){return this._logger.error("Failed to get rewrite. Error sending  disposable_cheetah:invokeCommand message to CAPI.",{error:e}),h.modify((e=>({...e,kind:"error",errorReason:"Failed to communicate with server."}))),h}}dispose(){this._subs.unsubscribe()}}const ce=r.lazy((()=>Promise.all([t.e(2251),t.e(6669),t.e(4352),t.e(274)]).then(t.bind(t,73947)).then((({SidelineCard:e})=>({default:e})))));var he=t(62965),ge=t(28043);function pe(e){return"improve"===e}var ue=t(12126);var me=t(5957),we=t(57757),fe=t(89093);class ve{constructor(e){var i;this._params=e,this._subs=new a.w,this._logger=c.Y.create("SidelineCardViewModelImpl"),this._visibleSidelineCard=l.h.create(x.YP),this._visibleSidelineCardSelectedRewriteType=l.h.create("improve"),this._visibleSidelineCardImproveRewriteInfo=l.h.create(x.G({kind:"idle",type:"improve"})),this._visibleSidelineCardRephraseRewriteInfo=l.h.create(x.G({kind:"idle",type:"rephrase"})),this._visibleSidelineCardCalliopeRewriteInfo=l.h.create(x.YP),this._visibleSidelineCardShortenRewriteInfo=l.h.create(x.YP),this._visibleSidelineCardFriendlyRewriteInfo=l.h.create(x.YP),this._visibleSidelineCardFormalRewriteInfo=l.h.create(x.YP),this.visibleSidelineCard=this._visibleSidelineCard.view(),this.visibleSidelineCardRewriteInfo=l.h.combine(this._visibleSidelineCardImproveRewriteInfo,this._visibleSidelineCardRephraseRewriteInfo,this._visibleSidelineCardCalliopeRewriteInfo,this._visibleSidelineCardShortenRewriteInfo,this._visibleSidelineCardFriendlyRewriteInfo,this._visibleSidelineCardFormalRewriteInfo,((e,i,t,r,a,n)=>({improve:e,rephrase:i,calliope:t,shorten:r,friendly:a,formal:n}))),this._subs.add((i=this._params.sidelineCollectionViewModel,u.aj([i.activeSideline,i.pinnedSideline]).pipe(n.U((([e,i])=>(0,d.zG)(i,x.UI((e=>({sideline:e,isPinned:!0}))),x.wp((()=>(0,d.zG)(e,x.UI((e=>({sideline:e,isPinned:!1}))))))))),n.U(x.tS((({sideline:e,isPinned:t})=>(0,d.zG)(i.getSidelineReferenceElement(e.id),x.UI((i=>({sidelineId:e.id,isSidelinePinned:t,sidelineSignal:e.signal,referenceElement:i}))))))))).subscribe((e=>{this._resetVisibleSidelineCard(),(0,me.gw)(0).then((()=>this._visibleSidelineCard.set(e)))}))),this._subs.add(this._visibleSidelineCard.pipe(q.oA,v.w((e=>this._visibleSidelineCardSelectedRewriteType.pipe(n.U((i=>({visibleSidelineCard:e,visibleSidelineCardRewriteType:i})))))),v.w((({visibleSidelineCard:e,visibleSidelineCardRewriteType:i})=>function(e,i,t,r,a){return(0,d.zG)(e.getSidelineById(r.sidelineId),x.tS((e=>i.getParagraphById(e.paragraphId))),x.UI((e=>ue.D(t.getRewrite(a,e.text,e.textRange)).pipe(b.q(1),v.w(d.yR),n.U(x.G)))),x.pF((()=>R.of(x.YP))))}(this._params.sidelineCollectionViewModel,this._params.paragraphCollectionService,this._params.rewriteService,e,i).pipe(n.U((e=>({rewriteType:i,rewrite:e}))))))).subscribe((({rewriteType:e,rewrite:i})=>{switch(e){case"improve":this._visibleSidelineCardImproveRewriteInfo.set(i);break;case"calliope":this._visibleSidelineCardCalliopeRewriteInfo.set(i);break;case"rephrase":this._visibleSidelineCardRephraseRewriteInfo.set(i);break;case"shorten":this._visibleSidelineCardShortenRewriteInfo.set(i);break;case"friendly":this._visibleSidelineCardFriendlyRewriteInfo.set(i);break;case"formal":this._visibleSidelineCardFormalRewriteInfo.set(i);break;default:(0,J.L0)(e)}})));const t=this._visibleSidelineCardSelectedRewriteType.pipe(ge.x(),C.h((0,fe.ff)(pe)));this._subs.add(t.subscribe((()=>{this._visibleSidelineCardCalliopeRewriteInfo.set(x.G({kind:"idle",type:"calliope"})),this._visibleSidelineCardShortenRewriteInfo.set(x.G({kind:"idle",type:"shorten"})),this._visibleSidelineCardFriendlyRewriteInfo.set(x.G({kind:"idle",type:"friendly"})),this._visibleSidelineCardFormalRewriteInfo.set(x.G({kind:"idle",type:"formal"}))})))}_resetVisibleSidelineCard(){this._visibleSidelineCard.set(x.YP),this._visibleSidelineCardRephraseRewriteInfo.set(x.G({type:"improve",kind:"idle"})),this._visibleSidelineCardRephraseRewriteInfo.set(x.G({type:"rephrase",kind:"idle"})),this._visibleSidelineCardCalliopeRewriteInfo.set(x.YP),this._visibleSidelineCardShortenRewriteInfo.set(x.YP),this._visibleSidelineCardFriendlyRewriteInfo.set(x.YP),this._visibleSidelineCardFormalRewriteInfo.set(x.YP),this._visibleSidelineCardSelectedRewriteType.set("improve")}activateSidelineCard(e){this._logger.debug("Activate sideline card.",{sidelineCard:e}),this._params.sidelineCollectionViewModel.notifySidelineCardActive(e.sidelineId)}deactivateSidelineCard(e){this._logger.debug("Deactivate sideline card.",{sidelineCard:e}),this._params.sidelineCollectionViewModel.notifySidelineCardInactive(e.sidelineId)}notifySelectedRewriteTypeChanged(e){this._logger.debug("Selected rewrite type changed.",{rewriteType:e}),this._visibleSidelineCardSelectedRewriteType.set(e)}applyRewrite(e,i){this._logger.debug("Apply rewrite.",{rewrite:e}),this._params.performReplacement({pos:e.textRange,value:e.rewriteText,oldValue:e.text}),this._params.sidelineCollectionViewModel.notifySidelineCardInactive(i.sidelineId,!0)}copyRewrite(e){return he.Y3((()=>(0,we.vQ)(e.rewriteText)),j.toError)}dispose(){this._subs.unsubscribe()}}var _e=t(3236),Ce=t(78674);function be(e){let i=0,t=0;const r=[];for(;t<=e.length;)"\n"!==e.charAt(t)&&""!==e.charAt(t)||(i!==t&&r.push({start:i,end:t}),i=t+1),t++;return r}class Se{constructor(e){this._params=e,this._subs=new a.w,this._logger=c.Y.create("ParagraphCollectionServiceImpl"),this._paragraphs=l.h.create([]),this._paragraphById=new Map,this.paragraphs=this._paragraphs.view(),this._subs.add(this._params.textObserver.contentChanges.async.pipe(C.h((e=>!e.deltaChange.isEmpty)),Ce.b(1e3),P.O(null),n.U((()=>{const e=this._params.textObserver.getCurrentTextMap().getPlainText();return{paragraphTextRanges:be(e),fullText:e}})),n.U((({paragraphTextRanges:e,fullText:i})=>{const t=e.map((e=>({id:`g2-paragraph-${e.start}-${e.end}`,textRange:e,text:i.slice(e.start,e.end)})));return this._logger.debug("Paragraphs updated.",{paragraphs:t}),t}))).subscribe(s.wW(this._paragraphs))),this._subs.add(this._paragraphs.subscribe((e=>{this._paragraphById.clear();for(const i of e)this._paragraphById.set(i.id,i)})))}getParagraphById(e){return x.ij(this._paragraphById.get(e))}dispose(){this._subs.unsubscribe()}}var ye=t(13718),Re=t(14505),xe=t(62874),Ie=t(68435),Ee=t(52423);var Fe=t(81964),Te=t(71249);class ke{constructor(e){this._params=e,this._subs=new a.w,this._logger=c.Y.create("ParagraphHighlightCollectionViewModelImpl"),this._paragraphHighlights=l.h.create([]),this._emphasizedParagraphHighlight=l.h.create(x.YP),this.paragraphHighlights=this._paragraphHighlights.view(),this.emphasizedParagraphHighlight=this._emphasizedParagraphHighlight.view(),this._subs.add(this._params.paragraphCollectionService.paragraphs.subscribe((e=>{const i=Array.from(this._params.highlightCollectionGeometry.geometry.get().keys());this._params.highlightCollectionGeometry.removeHighlights(i);for(const i of e){const e=G.y$.Id.create(`g2-paragraph-highlight-${i.textRange.start}-${i.textRange.end}`);this._params.highlightCollectionGeometry.addHighlight(e,i.textRange,{highlightId:e,alertId:i.id,highlightColor:null,highlightDisplayFormat:null,highlightLiveliness:null})}}))),this._subs.add(u.aj([this._params.integration.textFieldVisibleRect,this._params.textFieldLayout.rect.changes.pipe(P.O(this._params.textFieldLayout.rect.getCurrent())),this._params.textFieldLayout.scroll.changes.pipe(P.O(this._params.textFieldLayout.scroll.getCurrent())),this._params.highlightCollectionGeometry.geometry.view((e=>Array.from(e.values())))]).pipe(n.U((([e,i,t,r])=>{const a=r.reduce(((r,a)=>((0,d.zG)(function(e,i,t,r,a,n){return(0,d.zG)(x.ij((0,Ie.jr)(t)),x.UI((t=>{const s=(0,Ee.Z)({kind:"offsetPoint",...t},r,a),l=s.left-n.left,d=n.left+n.width-s.right,o={top:s.top,left:s.left-l,width:s.width+l+d,height:s.height};return{id:e,paragraphId:i,textFieldRect:{top:t.top,left:t.left-l,width:t.width+l+d,height:t.height},viewportRect:o,isScrolledIntoView:N.UL.doesRectContain(n,o)}})))}(a.meta.highlightId.toString(),a.meta.alertId,a.rects,i.client,t,e),x.g_((()=>{this._logger.warn("Failed to create paragraph highlight from highlight geometry. Skipping.",a)}),(e=>r.push(e)))),r)),[]);return this._logger.debug("Paragraph highlights updated.",{paragraphHighlights:a}),a}))).subscribe(s.wW(this._paragraphHighlights))),this._subs.add(this._params.mouseData.pipe(ye.U(xe.S.hz30),_.skipBy(Re.Z.eq),n.U((({client:e,offset:i})=>{return t=this._paragraphHighlights.get(),r=e,a=i,n=this._params.textFieldElement,null!==r&&null!==a&&(0,Fe._N)(r,n)?(0,d.zG)(t,Te.Ew((e=>N.UL.contains(a,e.textFieldRect)))):x.YP;var t,r,a,n}))).subscribe(s.wW(this._emphasizedParagraphHighlight)))}dispose(){this._subs.unsubscribe()}}var Me=t(54951),Le=t(98017);class Ge{constructor(e){this._params=e,this._subs=new a.w,this._logger=c.Y.create("G2FeatureImpl"),this._alertFilter=l.h.create(d.W8),this._integration=(0,B.a9)(this._params.integrationName)?new U({textFieldLayout:this._params.textFieldLayout,textFieldElement:this._params.textFieldElement,textObserver:this._params.textObserver}):new D({integrationName:this._params.integrationName,textFieldLayout:this._params.textFieldLayout,textFieldElement:this._params.textFieldElement}),this._rewriteService=new oe({checkingService:this._params.checkingService}),this._paragraphCollectionService=new Se({textObserver:this._params.textObserver}),this._highlightCollectionGeometry=new Me.C(this._params.geometryProvider,this._params.geometryLayout,(()=>this._params.textObserver.getCurrentTextMap()),this._integration.highlightCollectionGeometryFilter,(0,G.WF)(this._params.textFieldLayout),(0,Le.m)()),this._paragraphHighlightCollectionViewModel=new ke({paragraphCollectionService:this._paragraphCollectionService,highlightCollectionGeometry:this._highlightCollectionGeometry,textFieldLayout:this._params.textFieldLayout,mouseData:this._params.mouseData,textFieldElement:this._params.textFieldElement,integration:this._integration}),this._sidelineCollectionViewModel=new L({paragraphCollectionService:this._paragraphCollectionService,paragraphHighlightCollectionViewModel:this._paragraphHighlightCollectionViewModel,alerts:this._params.alertProcessor.alerts.state.view((e=>Object.values(e).filter(I.Nf).filter(o.S.isTransformJsonCapiAlert))),textObserver:this._params.textObserver,textFieldLayout:this._params.textFieldLayout,textFieldElement:this._params.textFieldElement}),this._replacementService=this._params.replacementServiceInjector.create(_e.P.g2),this._sidelineCardViewModel=new ve({rewriteService:this._rewriteService,paragraphCollectionService:this._paragraphCollectionService,sidelineCollectionViewModel:this._sidelineCollectionViewModel,performReplacement:e=>this._replacementService.performReplacement(e)}),this.alertFilter=this._alertFilter.view(),this._logger.debug("G2 initialized on:",this._params.integrationName),this._subs.add(this._params.alertClassification.visibleInlineAlertsFilter.pipe(n.U((e=>i=>{return e(i)&&(t=i,o.S.isTransformJsonCapiAlert(t)&&t.outcome===Y.TC.correctness&&t.transformJSON.highlights.every((e=>"enclosing"!==e.type)));var t}))).subscribe(s.wW(this._alertFilter)))}get paragraphHighlightsUI(){return r.createElement(r.Suspense,{fallback:r.createElement(r.Fragment,null)},r.createElement(h,{paragraphHighlights:this._paragraphHighlightCollectionViewModel.paragraphHighlights}))}get sidelinesUI(){return r.createElement(r.Suspense,{fallback:r.createElement(r.Fragment,null)},r.createElement(g,{sidelines:this._sidelineCollectionViewModel.sidelines,emphasizedSideline:this._sidelineCollectionViewModel.emphasizedSideline,activeSideline:this._sidelineCollectionViewModel.activeSideline,pinnedSideline:this._sidelineCollectionViewModel.pinnedSideline,shouldHideSidelines:this._sidelineCollectionViewModel.shouldHideSidelines,onActivateSideline:e=>this._sidelineCollectionViewModel.activateSideline(e),onDeactivateSideline:e=>this._sidelineCollectionViewModel.deactivateSideline(e),onPinSideline:e=>this._sidelineCollectionViewModel.pinSideline(e),onUnpinSideline:e=>this._sidelineCollectionViewModel.unpinSideline(e),onMountSideline:(e,i)=>this._sidelineCollectionViewModel.setSidelineReferenceElement(e,i)}))}get sidelineCardUI(){return r.createElement(r.Suspense,{fallback:r.createElement(r.Fragment,null)},r.createElement(ce,{visibleSidelineCard:this._sidelineCardViewModel.visibleSidelineCard,visibleSidelineCardRewriteInfo:this._sidelineCardViewModel.visibleSidelineCardRewriteInfo,onActivateSidelineCard:e=>this._sidelineCardViewModel.activateSidelineCard(e),onDeactivateSidelineCard:e=>this._sidelineCardViewModel.deactivateSidelineCard(e),onChangeSelectedRewriteType:e=>this._sidelineCardViewModel.notifySelectedRewriteTypeChanged(e),onApplyRewrite:(e,i)=>this._sidelineCardViewModel.applyRewrite(e,i),onCopyRewrite:e=>this._sidelineCardViewModel.copyRewrite(e)}))}dispose(){this._subs.unsubscribe(),this._integration.dispose(),this._rewriteService.dispose(),this._paragraphCollectionService.dispose(),this._highlightCollectionGeometry.dispose(),this._paragraphHighlightCollectionViewModel.dispose(),this._sidelineCollectionViewModel.dispose(),this._sidelineCardViewModel.dispose()}}},10180:(e,i,t)=>{t.r(i),t.d(i,{ParagraphHighlightCollection:()=>l});var r=t(8543),a=t(27378),n=t(41572),s=t(14711);const l=({paragraphHighlights:e})=>a.createElement(r.F.Fragment,null,e.view((e=>a.createElement(n.L,{key:"g2",chunkName:"g2"},e.map((e=>a.createElement("div",{"data-testid":"grammarly-g2-paragraph-highlight",className:s.paragraphHighlight,key:e.id,style:{top:e.textFieldRect.top,left:e.textFieldRect.left,width:e.textFieldRect.width,height:e.textFieldRect.height}})))))))},73947:(e,i,t)=>{t.r(i),t.d(i,{SidelineCard:()=>Q});var r=t(8543),a=t(27378),n=t(37869),s=t(17434);const l=({referenceElement:e,onMouseEnter:i,onMouseLeave:t,onFocus:r,onBlur:l,children:d})=>{const[o,c]=a.useState(null),{styles:h,attributes:g,state:p}=(0,n.D)(e,o,{placement:"bottom-start"});return a.createElement("div",{"data-testid":"grammarly-g2-sideline-card-popper",role:"dialog","aria-label":"Suggested rewrite dialog",tabIndex:0,ref:c,style:h.popper,className:s.sidelineCardPopper,onMouseEnter:i,onMouseLeave:t,onFocus:r,onBlur:l,...g.popper},d(null==p?void 0:p.placement))};var d=t(22232),o=t(73168);const c=()=>a.createElement("div",{className:o.sidelineCardRewriteLoadingSkeleton,"data-testid":"grammarly-g2-sideline-card-rewrite-loading-skeleton"},a.createElement("div",{className:o.sidelineCardRewriteLoadingSkeletonSignal}),a.createElement("div",{className:o.sidelineCardRewriteLoadingSkeletonContent},a.createElement("div",{className:o.sidelineCardRewriteLoadingSkeletonContentTitle}),a.createElement("div",{className:o.sidelineCardRewriteLoadingSkeletonContentText},a.createElement("div",{className:o.sidelineCardRewriteLoadingSkeletonContentTextLine}),a.createElement("div",{className:o.sidelineCardRewriteLoadingSkeletonContentTextLine}),a.createElement("div",{className:o.sidelineCardRewriteLoadingSkeletonContentTextLine}))));var h=t(6861),g=t(46354),p=t(40223),u=t(40938),m=t(98685);const w=({title:e,text:i})=>a.createElement("div",{className:h.sidelineCardRewriteSuccess,"data-testid":"grammarly-g2-sideline-card-rewrite-success"},a.createElement("div",{className:h.sidelineCardRewriteSuccessMain,"data-testid":"grammarly-g2-sideline-card-rewrite-success-main"},a.createElement(g.J,{size:"small",accessibilityLabel:"",icon:p.j}),a.createElement("div",{className:h.sidelineCardRewriteSuccessMainContent,"data-testid":"grammarly-g2-sideline-card-rewrite-success-main-content"},a.createElement(u.x,{className:h.sidelineCardRewriteSuccessMainContentTitle,as:"strong",color:"brand-default",variant:"text-small"},e),a.createElement(u.x,{as:"p",variant:"text-small",color:"base-subdued"},i))),a.createElement("div",{className:h.sidelineCardRewriteSuccessFooter,"data-testid":"grammarly-g2-sideline-card-rewrite-success-footer"},a.createElement(g.J,{size:"small",icon:m.p,accessibilityLabel:"Grammarly logo"})));var f=t(43043),v=t(54001),_=t(46420),C=t(95195),b=t(11559),S=t(77773),y=t(96833),R=t(57050),x=t(55649),I=t(35574);const E=e=>{const i=a.useRef(x.Y.create("SidelineCardRewriteCopyButton")),[t,r]=a.useState(!1),n=a.useRef(void 0),s=a.useCallback((()=>{void 0!==n.current&&(self.clearTimeout(n.current),n.current=void 0)}),[]);a.useEffect(s,[]);return a.createElement(b.k,{className:I.sidelineCardRewriteCopyButton},t&&a.createElement(b.k,{className:I.sidelineCardRewriteCopyButtonCopyConfirmation,bgColor:"background-base-default"},a.createElement(u.x,{as:"p",variant:"text-xsmall",color:"base-subdued"},"Copied")),a.createElement(S.h,{variant:"tertiary",accessibilityLabel:"Copy",icon:y.c,size:"small",onClick:async()=>{(0,R.zG)(await e.onClick(),C.match((e=>{i.current.error("Failed to copy rewrite.",e)}),(()=>{r(!0),s(),n.current=self.setTimeout((()=>{r(!1)}),3e3)})))}}))};var F=t(71249),T=t(66347),k=t(17138);const M={color:k.I.Text.Brand.Default,background:"rgba(177, 240, 232, 0.6)",fontWeight:"bold"},L={color:"#696969",backgroundColor:"rgba(156, 156, 156, 0.2)",textDecoration:"line-through"},G={color:k.I.Text.Base.Default,backgroundColor:k.I.Background.Base.Default},B=({diff:e})=>a.createElement("p",null,(0,R.zG)(e,F.Su(((e,i)=>(0,R.zG)(i,T.F.matchOperation({onDelete:i=>a.createElement(u.x,{as:"span",variant:"text-small",key:e,style:L},i),onInsert:i=>a.createElement(u.x,{as:"span",variant:"text-small",key:e,style:M},i),onRetain:i=>a.createElement(u.x,{as:"span",variant:"text-small",key:e,style:G},i)}))))));var P=t(5114);function z(e){return"attention"===e?f.sidelineCardRewriteReadyContentTitleAttention:"writingCoach"===e?f.sidelineCardRewriteReadyContentTitleWritingCoach:f.sidelineCardRewriteReadyContentTitleDefault}const N=e=>{const[i,t]=a.useState(null);return a.createElement("div",{className:f.sidelineCardRewriteReady,"data-testid":"grammarly-g2-sideline-card-rewrite-ready"},a.createElement("div",{...(0,v.Sh)(f.sidelineCardRewriteReadySignalBar,(n=e.signal,"attention"===n?f.sidelineCardRewriteReadySignalBarAttention:"writingCoach"===n?f.sidelineCardRewriteReadySignalBarWritingCoach:f.sidelineCardRewriteReadySignalBarDefault)),"data-testid":"grammarly-g2-sideline-card-rewrite-ready-signal"}),a.createElement("div",{className:f.sidelineCardRewriteReadyContainer,"data-testid":"grammarly-g2-sideline-card-rewrite-ready-container"},a.createElement("div",{className:(r=null==i?void 0:i.getBoundingClientRect().height,r&&r>=190?f.sidelineCardRewriteReadyContentScrollable:f.sidelineCardRewriteReadyContent),"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content",ref:t},a.createElement(u.x,{...(0,v.Sh)(f.sidelineCardRewriteReadyContentTitle,z(e.signal)),as:"strong",variant:"text-small"},e.title),(0,R.zG)(e.diff,P.UI((e=>a.createElement(B,{key:"diff",diff:e}))),P.fS((()=>a.createElement(u.x,{as:"p",variant:"text-small"},e.newText))))),a.createElement("div",{className:f.sidelineCardRewriteReadyContentToolbar,"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-toolbar"},a.createElement("div",{className:f.sidelineCardRewriteReadyContentToolbarLeft,"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-toolbar-left"},a.createElement(_.z,{variant:"tertiary",text:"apply"===e.applyCTA?"Accept":"Insert",shortcut:"⮐",size:"small",onClick:e.onApply,"data-testid":"apply"===e.applyCTA?"grammarly-g2-sideline-card-rewrite-ready-content-apply-btn":"grammarly-g2-sideline-card-rewrite-ready-content-insert-btn",className:f.sidelineCardRewriteReadyContentToolbarLeftActionBtn})),a.createElement("div",{className:f.sidelineCardRewriteReadyContentToolbarRight,"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-toolbar-right"},a.createElement(E,{onClick:e.onCopy}),a.createElement(g.J,{icon:m.p,accessibilityLabel:"Grammarly logo"})))));var r,n};var V=t(94504),A=t(12271);function U(e){switch(e){case"SENSITIVE_CONTENT":return["Assistance unavailable","Grammarly can't help with this due to potentially sensitive content. Try something different."];case"WRONG_REVISION":case"USER_TEXT_BLANK":case"NO_PROMPTS":case"UNKNOWN_CLIENT_REQUEST":case"EXCEPTION":return["Couldn’t generate ideas","Please wait a moment, then try again."];default:return[e,"Please wait a moment, then try again."]}}const H=({errorReason:e})=>a.createElement(b.k,{direction:"column",align:"center",gap:.5,padding:8,"data-testid":"grammarly-g2-sideline-card-rewrite-error"},a.createElement(g.J,{icon:V.F,size:"large",variant:"warning",accessibilityLabel:"","data-testid":"grammarly-g2-sideline-card-rewrite-error-icon"}),a.createElement(u.x,{as:"p",variant:"text-medium",color:"base-default",align:"center","data-testid":"grammarly-g2-sideline-card-rewrite-error-title"},(0,A.li)(U(e))),a.createElement(u.x,{as:"p",variant:"text-small",color:"base-subdued",align:"center","data-testid":"grammarly-g2-sideline-card-rewrite-error-subtitle"},(0,A.Yg)(U(e)))),O=e=>a.createElement("div",{role:"region","aria-live":"error"===e.kind?"assertive":"polite","aria-busy":"loading"===e.kind,"aria-label":D(e.kind),"data-testid":"grammarly-g2-sideline-card-rewrite"},(()=>{switch(e.kind){case"loading":return a.createElement(c,null);case"ready":return a.createElement(N,{signal:e.signal,title:e.title,newText:e.newText,diff:e.diff,applyCTA:e.applyCTA,onApply:e.onApply,onCopy:e.onCopy});case"success":return a.createElement(w,{title:e.title,text:e.text});case"error":return a.createElement(H,{errorReason:e.errorReason});default:(0,d.L0)(e)}})());function D(e){switch(e){case"loading":return"Loading suggested rewrite";case"ready":case"success":return"Suggested rewrite";case"error":return"An error occurred";default:(0,d.L0)(e)}}var Y=t(50995),W=t(6753);const J=({shortenRewriteInfo:e,friendlyRewriteInfo:i,formalRewriteInfo:t})=>a.createElement(W.m.TabList,{accessibilityLabel:"Type of rewrite",bottomBorder:"none"},a.createElement(W.m.Tab,{id:"improve",label:"Improve"}),a.createElement(W.m.Tab,{id:"rephrase",label:"Rephrase"}),e&&a.createElement(W.m.Tab,{id:"shorten",label:"Shorten"}),i&&a.createElement(W.m.Tab,{id:"friendly",label:"Friendly"}),t&&a.createElement(W.m.Tab,{id:"formal",label:"Formal"})),j=({improveRewriteInfo:e,rephraseRewriteInfo:i,shortenRewriteInfo:t,friendlyRewriteInfo:r,formalRewriteInfo:n})=>a.createElement(a.Fragment,null,a.createElement(W.m.Panel,{id:"improve"},a.createElement(O,{...e})),a.createElement(W.m.Panel,{id:"rephrase"},a.createElement(O,{...i})),t&&a.createElement(W.m.Panel,{id:"shorten"},a.createElement(O,{...t})),r&&a.createElement(W.m.Panel,{id:"friendly"},a.createElement(O,{...r})),n&&a.createElement(W.m.Panel,{id:"formal"},a.createElement(O,{...n}))),$=({tabListPosition:e,improveRewriteInfo:i,rephraseRewriteInfo:t,shortenRewriteInfo:r,friendlyRewriteInfo:n,formalRewriteInfo:s,onChangeSelectedRewriteType:l})=>{const d=a.createElement(J,{shortenRewriteInfo:r,friendlyRewriteInfo:n,formalRewriteInfo:s}),o=a.createElement(j,{improveRewriteInfo:i,rephraseRewriteInfo:t,shortenRewriteInfo:r,friendlyRewriteInfo:n,formalRewriteInfo:s});return a.createElement("div",{className:Y.sidelineCard,"data-testid":"grammarly-g2-sideline-card"},a.createElement(W.m,{defaultSelectedTab:"improve",onChange:e=>l(e)},"top"===e?d:o,a.createElement("div",{className:Y.sidelineCardHorizontalDivider}),"bottom"===e?d:o))};var q=t(41572);const Q=({visibleSidelineCard:e,visibleSidelineCardRewriteInfo:i,onActivateSidelineCard:t,onDeactivateSidelineCard:n,onChangeSelectedRewriteType:s,onApplyRewrite:o,onCopyRewrite:c})=>{const h=(e,i)=>(0,R.zG)(e,P.UI((e=>function(e,i,t,r){return"loading"===e.kind||"idle"===e.kind?{kind:"loading"}:"ready"===e.kind?e.text===e.rewriteText?{kind:"success",title:"This text looks great!",text:"To rephrase your text, select another option."}:{kind:"ready",title:e.title,newText:e.rewriteText,diff:e.rewriteDiff,applyCTA:"improve"===e.type?"apply":"insert",onApply:()=>t(e),onCopy:r(e),signal:(0,R.zG)(i,P.hX((()=>"improve"===e.type)),P.hX((e=>"attention"===e||"writingCoach"===e)),P.FS)}:"error"===e.kind?{kind:"error",errorReason:e.errorReason}:void(0,d.L0)(e)}(e,i.sidelineSignal,(e=>o(e,i)),(e=>c(e))))));return a.createElement(r.F.Fragment,null,e.view((0,R.ls)(P.UI((e=>a.createElement(q.L,{key:"g2",chunkName:"g2"},a.createElement(l,{referenceElement:e.referenceElement,onMouseEnter:()=>t(e),onMouseLeave:()=>{e.isSidelinePinned||n(e)},onFocus:()=>t(e),onBlur:()=>n(e)},(t=>a.createElement(r.F.Fragment,null,i.view((({improve:i,rephrase:r,shorten:n,friendly:l,formal:d})=>a.createElement($,{tabListPosition:"bottom"===t||"bottom-end"===t||"bottom-start"===t?"top":"bottom",improveRewriteInfo:(0,R.zG)(h(i,e),P.pF((()=>({kind:"loading"})))),rephraseRewriteInfo:(0,R.zG)(h(r,e),P.pF((()=>({kind:"loading"})))),shortenRewriteInfo:(0,R.zG)(h(n,e),P.pF((()=>{}))),friendlyRewriteInfo:(0,R.zG)(h(l,e),P.pF((()=>{}))),formalRewriteInfo:(0,R.zG)(h(d,e),P.pF((()=>{}))),onChangeSelectedRewriteType:e=>s(e)}))))))))),P.WG)))}},58876:(e,i,t)=>{t.r(i),t.d(i,{SidelineCollection:()=>f});var r=t(5114),a=t(8543),n=t(23239),s=t(54001),l=t(57050),d=t(27378),o=t(41572),c=t(38527),h=t(46354),g=t(80463),p=t(22232);const u=d.forwardRef((function({emphasized:e,signal:i,heightInPixels:t,onClick:r,onMouseOver:a,onMouseOut:n,onFocus:l,onBlur:o},u){const m=("attention"===i||"loading"===i||"writingCoach"===i)&&!(e&&!(t>=24));return d.createElement("button",{"data-testid":"grammarly-g2-sideline",...(0,s.Sh)(c.sideline,e?c.sidelineEmphasized:c.sidelineIdle,"selection"===i?c.sidelineWithSelectionSignal:void 0,m?c.sidelineWithSignalBar:void 0),style:{height:t,width:16},disabled:!e,onClick:e?r:void 0,onFocus:e?l:void 0,onBlur:e?o:void 0,onMouseOver:a,onMouseOut:n,"aria-label":"See rewrite suggestions",ref:u},d.createElement("div",{...(0,s.Sh)(c.sidelineSignalBar,(e=>{switch(e){case"loading":return c.sidelineSignalBarLoading;case"attention":return c.sidelineSignalBarAttention;case"writingCoach":return c.sidelineSignalBarWritingCoach;case"selection":case void 0:return;default:(0,p.L0)(e)}})(i),e?c.sidelineSignalBarEmphasized:void 0,m?void 0:c.sidelineSignalBarHidden),role:"status","aria-label":"Rewrite suggestions available"}),d.createElement(h.J,{...(0,s.Sh)(c.sidelineArrow,e?c.sidelineArrowVisible:void 0,m?c.sidelineArrowBottom:void 0),icon:g.b,accessibilityLabel:"",size:"small",variant:"selection"===i?"inverse":"default"}))}));var m=t(63954);function w(e,i,t,a){return(0,l.zG)(i,r.UI((i=>i===e)),r.fS((()=>(0,l.zG)(t,r.UI((i=>i===e)),r.fS((()=>!1)))||(0,l.zG)(a,r.UI((i=>i===e)),r.fS((()=>!1))))))}const f=({sidelines:e,emphasizedSideline:i,activeSideline:t,pinnedSideline:c,shouldHideSidelines:h,onActivateSideline:g,onDeactivateSideline:p,onPinSideline:f,onUnpinSideline:v,onMountSideline:_})=>d.createElement(a.F.Fragment,null,n.h.combine(e,i,t,c,h,((e,i,t,a,n)=>d.createElement(o.L,{key:"g2",chunkName:"g2"},!n&&e.map((e=>{return d.createElement(d.Fragment,{key:e.id},d.createElement("span",{"data-testid":"grammarly-g2-sideline-paragraph-highlighter",...(0,s.Sh)(m.sidelineParagraphHighlighter,(n=e.id,o=(0,l.zG)(a,r.UI((e=>e.id))),c=(0,l.zG)(t,r.UI((e=>e.id))),(0,l.zG)(o,r.UI((e=>e===n)),r.wp((()=>(0,l.zG)(c,r.UI((e=>e===n))))),r.fS((()=>!1)))?m.sidelineParagraphHighlighterActive:void 0)),style:{top:e.paragraphHighlightViewportRect.top-4,left:e.paragraphHighlightViewportRect.left-8-4,width:e.paragraphHighlightViewportRect.width+8+8,height:e.paragraphHighlightViewportRect.height+8},ref:i=>{i&&_(e.id,i)}}),d.createElement("span",{"data-testid":"grammarly-g2-sideline-positioner",className:m.sidelinePositioner,style:{top:e.paragraphHighlightViewportRect.top,left:e.paragraphHighlightViewportRect.left-8}},d.createElement(u,{emphasized:w(e.id,(0,l.zG)(a,r.UI((e=>e.id))),(0,l.zG)(t,r.UI((e=>e.id))),(0,l.zG)(i,r.UI((e=>e.id)))),signal:r.FS(e.signal),heightInPixels:e.paragraphHighlightViewportRect.height,onClick:()=>f(e.id),onFocus:()=>f(e.id),onBlur:()=>v(e.id),onMouseOver:()=>g(e.id),onMouseOut:()=>p(e.id)})));var n,o,c}))))))},66347:(e,i,t)=>{t.d(i,{F:()=>r});var r,a=t(22826),n=t(12271),s=t(95195),l=t(26328),d=t(57050),o=t(48015);!function(e){let i;e.getDiff=(e,i)=>(0,d.zG)(s.tryCatch((()=>{const t=new a.diff_match_patch,r=t.diff_main(e,i);return t.diff_cleanupSemantic(r),r}),s.toError),s.chain((0,d.ls)(l.nI,s.fromOption((()=>new Error("Diff is empty")))))),function(e){e[e.DELETE=-1]="DELETE",e[e.RETAIN=0]="RETAIN",e[e.INSERT=1]="INSERT"}(i=e.Operation||(e.Operation={})),e.matchOperation=function({onInsert:e,onDelete:t,onRetain:r}){return a=>{const s=(0,n.li)(a);switch(s){case i.INSERT:return e((0,n.Yg)(a));case i.DELETE:return t((0,n.Yg)(a));case i.RETAIN:return r((0,n.Yg)(a));default:(0,o.vE)(s)}}}}(r||(r={}))},46297:(e,i,t)=>{t.d(i,{$x:()=>s,F8:()=>u,Go:()=>a,Kt:()=>b,Lq:()=>o,Q2:()=>_,QR:()=>E,Qy:()=>f,Vk:()=>S,Wp:()=>r,XG:()=>n,_m:()=>g,d0:()=>c,f:()=>d,gH:()=>w,gL:()=>y,gv:()=>m,ij:()=>I,j5:()=>C,jW:()=>p,lO:()=>x,os:()=>v,rx:()=>R,uj:()=>h,y1:()=>l});const r=".kix-appview-editor",a=".docos-input",n=".docs-texteventtarget-iframe",s=".kix-cursor",l=".kix-cursor-caret",d="#docs-revisions-sidebar",o='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',c="#docs-toolbar-mode-switcher",h="edit-mode",g="suggest-mode",p="#titlebar-mode-indicator-container .titlebar-request-access-button",u="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",m=".kix-canvas-tile-content",w="canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)",f=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)",v=".kix-page-paginated.canvas-first-page",_="kix-page-canvas-compact-mode",C=".docs-horizontal-ruler",b=".docs-vertical-ruler",S="#fontSizeSelect input",y=".docs-ruler-background",R=".docs-ruler-background-inner",x=".docs-ruler-indent-first-line",I=".modal-dialog.docs-dialog .fatal-error-message",E='#docs-titlebar-share-client-button div[role="button"]'},35550:(e,i,t)=>{t.d(i,{b:()=>l});var r=t(14601),a=t(68006),n=t(7604),s=t(23239);class l{constructor(e){this._textObserver=e,this._mapChangedAtom=s.h.create([0,[]]),this._sub=new r.w,this.highlightsFilterFactory=()=>s.h.combine((0,a.u)(),this._mapChangedAtom,((e,i)=>{const t=this._textObserver.getCurrentTextMap();return{filter:i=>e.filter(i)&&(null!==t.getFragmentAtOffset(i.start)||null!==t.getFragmentAtOffset(i.end)||null!==t.getFragmentAtOffset(i.end-1)),type:n.qH.ChangeType.preserve}})),this._sub.add(this._textObserver.textMapChanged.subscribe((e=>{this._mapChangedAtom.modify((([i,t])=>[i+1,e]))})))}dispose(){this._sub.unsubscribe()}}},18431:(e,i,t)=>{var r;t.d(i,{u:()=>r}),function(e){e.gmailReply="Gmail reply compose",e.gmailCompose="compose",e.gmailComposeStandalone="compose standalone",e.gmailComposeFullScreen="compose fullscreen",e.slackMessage="Slack Message",e.slackGenericQuill="Slack Generic Quill",e.slackThread="Slack Thread"}(r||(r={}))},57757:(e,i,t)=>{t.d(i,{Sz:()=>n,vQ:()=>a});var r=t(95195);async function a(e,i=self){if(function(e=self){var i,t;return!!(null===(t=null===(i=e.navigator)||void 0===i?void 0:i.clipboard)||void 0===t?void 0:t.writeText)}(i))return i.navigator.clipboard.writeText(e);throw new Error("Clipboard API not supported")}function n(e,i=self){return a(e,i).then((()=>r.right(void 0))).catch((e=>r.left(e instanceof Error?e:new Error(String(e)))))}},14717:(e,i,t)=>{function r(e,i=0){return(i<<5)-i+(0|e)|0}function a(e,i=0){let t=i;for(const i of e)t=r(i.charCodeAt(0),t);return t}t.d(i,{Wu:()=>a,k3:()=>r})},38527:e=>{e.exports={sideline:"G2vdT",sidelineEmphasized:"tw3gA",sidelineWithSelectionSignal:"ikZS7",sidelineWithSignalBar:"gtUhG",sidelineSignalBar:"Pdlcn",sidelineSignalBarLoading:"ZhtAx",pulse:"PEPt4",sidelineSignalBarAttention:"xQocX",sidelineSignalBarWritingCoach:"O4JQp",sidelineSignalBarEmphasized:"_mi1U",sidelineSignalBarHidden:"BNKg6",sidelineArrow:"Ihuz1",sidelineArrowVisible:"gtlTF",sidelineArrowBottom:"PPzfY"}},50995:e=>{e.exports={sidelineCard:"KetZV",sidelineCardHorizontalDivider:"d96oB"}},17434:e=>{e.exports={sidelineCardPopper:"m2vlI"}},35574:e=>{e.exports={sidelineCardRewriteCopyButton:"_kIwY","5rem":"TE61X",sidelineCardRewriteCopyButtonCopyConfirmation:"eH5TV"}},73168:e=>{e.exports={sidelineCardRewriteLoadingSkeleton:"AZpqD",sidelineCardRewriteLoadingSkeletonSignal:"QmlkU",blink:"ME70b",sidelineCardRewriteLoadingSkeletonContent:"pCdaZ",sidelineCardRewriteLoadingSkeletonContentTitle:"njaNp",sidelineCardRewriteLoadingSkeletonContentText:"tFJmW",sidelineCardRewriteLoadingSkeletonContentTextLine:"CUydw"}},43043:e=>{e.exports={sidelineCardRewriteReady:"aC0Qq",sidelineCardRewriteReadySignalBar:"zv_Ws",sidelineCardRewriteReadySignalBarAttention:"oimfv",sidelineCardRewriteReadySignalBarWritingCoach:"OgCkm",sidelineCardRewriteReadySignalBarDefault:"GGpaV",sidelineCardRewriteReadyContainer:"JCAN0",sidelineCardRewriteReadyContentScrollable:"Cq6T4",sidelineCardRewriteReadyContent:"ANoVu",sidelineCardRewriteReadyContentTitle:"JruGr",sidelineCardRewriteReadyContentTitleAttention:"ncGgB",sidelineCardRewriteReadyContentTitleWritingCoach:"TNHGD",sidelineCardRewriteReadyContentTitleDefault:"FKJEV",sidelineCardRewriteReadyContentToolbar:"AkoCa",sidelineCardRewriteReadyContentToolbarLeft:"Fl51m",sidelineCardRewriteReadyContentToolbarLeftActionBtn:"s_g6E",sidelineCardRewriteReadyContentToolbarRight:"UPwBp"}},6861:e=>{e.exports={sidelineCardRewriteSuccess:"qCfRi",sidelineCardRewriteSuccessMain:"EHpcl",sidelineCardRewriteSuccessMainContent:"YnX7U",sidelineCardRewriteSuccessMainContentTitle:"KYYEg",sidelineCardRewriteSuccessFooter:"mKGH0"}},14711:e=>{e.exports={paragraphHighlight:"GdUyo"}},63954:e=>{e.exports={sidelineParagraphHighlighter:"ch8Da",sidelineParagraphHighlighterActive:"x3IoY",sidelinePositioner:"lx6ct"}}}]);