(self.webpackChunk=self.webpackChunk||[]).push([[274],{23086:(e,t,i)=>{i.r(t),i.d(t,{G2FeatureImpl:()=>gt});var r=i(27378),n=i(14601),a=i(77176),s=i(98403),l=i(23239),o=i(57050),d=i(20236),c=i(55649);const h=r.lazy((()=>Promise.all([i.e(2251),i.e(6669),i.e(274)]).then(i.bind(i,30494)).then((({ParagraphHighlightCollection:e})=>({default:e}))))),u=r.lazy((()=>Promise.all([i.e(2251),i.e(6669),i.e(274)]).then(i.bind(i,65211)).then((({SidelineCollection:e})=>({default:e})))));var p=i(32952),g=i(2844),m=i(85985),f=i(23063),v=i(17343),b=i(97425),w=i(76974),C=i(5114),_=i(48015);var S=i(36991);function y(e){return e.trim().split(/\s+/).filter((e=>""!==e)).length}function R(e,t){return e.map((e=>function(e,t){return(0,o.zG)(e.transformJSON.alternatives,C.UI((({alternatives:e,context:t})=>({alternative:e[0],context:t[0]}))),C.UI((({alternative:e,context:t})=>({ops:e.ops,context:t}))),C.UI((({ops:i,context:r})=>{let n=r.s,a=0;for(const e of i)S.s.match((e=>{S.s.isInsertString(e)&&(a+=y(e.insert),n+=e.insert.length)}),(e=>{const i=n+e.delete;a+=y(t.slice(n,i)),n=i}),(e=>{n+=e.retain}))(e);return a*((s=e.patternName).includes("MissingSpace")||s.includes("RedundantSpace")||s.includes("Clarity")||s.includes("Punctuation")?.5:s.includes("Formatting")||s.includes("Passive")||s.includes("Dialects")?.25:s.includes("Calliope")?.75:s.includes("Tone")||s.includes("Engagement")?.1:s.includes("RunOn")?2:s.includes("Style")?.5:s.includes("Fluency")||s.includes("FluencyRewrite")?.25:1);var s})),C.fS((()=>0)))}(e,t))).reduce(((e,t)=>e+t),0)}function I(e,t,i){if(e.text.length<50)return"none";const r=function(e,t){return e.filter((e=>e.transformJSON.highlights.some((e=>e.s>=t.start&&e.e<=t.end))))}(t,e.textRange);if(r.some((e=>e.patternName.startsWith("WritingExpert"))))return"purple";const n=R(r.filter((e=>!e.patternName.startsWith("WritingExpert"))),i),a=(s=e.text,Math.max(5,Math.min(10,y(s)/10)));var s;return Math.round(n)>=a?"red":"none"}class x{constructor(e){this._params=e,this._subs=new n.w,this._logger=c.Y.create("SidelineCollectionViewModelImpl"),this._sidelines=l.h.create([]),this._sidelineById=new Map,this._emphasizedSideline=l.h.create(C.YP),this._activeSideline=l.h.create(C.YP),this._pinnedSideline=l.h.create(C.YP),this._referenceElementBySidelineId=new Map,this._sidelineCardActiveNotifications=new p.xQ,this._deactivateSidelineSubs=new n.w,this._unpinSidelineSubs=new n.w,this.sidelines=this._sidelines.view(),this.emphasizedSideline=this._emphasizedSideline.view(),this.activeSideline=this._activeSideline.view(),this.pinnedSideline=this._pinnedSideline.view(),this._subs.add(g.aj([this._params.paragraphHighlightCollectionViewModel.paragraphHighlights,this._params.alerts]).pipe(a.U((([e,t])=>e.map((e=>{const i=(0,o.zG)(this._params.paragraphCollectionService.getParagraphById(e.paragraphId),C.g_((()=>null),(i=>function(e,t,i,r){const n=`g2-sideline-${e.textRange.start}-${e.textRange.end}`,a=I(e,i,r);return{id:n,paragraphId:e.id,viewportRect:{top:t.viewportRect.top,left:t.viewportRect.left,height:t.viewportRect.height},signalColor:a}}(i,e,t,this._params.textObserver.getCurrentTextMap().getPlainText()))));return null===i?(this._logger.warn("Failed to create sideline for paragraph; skipping.",{paragraphId:e.paragraphId}),null):i})).filter(_.Nf)))).subscribe(s.wW(this._sidelines))),this._subs.add(g.aj([this.sidelines,this._params.paragraphHighlightCollectionViewModel.emphasizedParagraphHighlight]).pipe(a.U((([e,t])=>(0,o.zG)(t,C.tS((t=>C.ij(e.find((e=>e.paragraphId===t.paragraphId))))))))).subscribe(s.wW(this._emphasizedSideline))),this._subs.add(this._sidelines.subscribe((e=>{this._sidelineById.clear();for(const t of e)this._sidelineById.set(t.id,t)})))}_doesSidelineIdMatchRelevantSideline(e,t){return(0,o.zG)(t,C.g_((()=>!1),(t=>e===t.id)))}_getSidelineById(e){return C.ij(this._sidelineById.get(e))}_deactivateSideline(e,t=!1){this._logger.debug("Deactivating sideline.",{sidelineId:e}),this._doesSidelineIdMatchRelevantSideline(e,this._activeSideline.get())?this._deactivateSidelineSubs=this._sidelineCardActiveNotifications.pipe(m.h((t=>t===e)),f.q(1),v.h(!1),b.L(t?0:1e3,w.of(!0))).subscribe((t=>{t?(this._logger.debug("Did not receive notification that corresponding sideline card is active, proceeding to deactivate sideline.",{sidelineId:e}),this._activeSideline.set(C.YP)):this._logger.debug("Received a notification that corresponding sideline card is active, won't deactivate sideline.",{sidelineId:e})})):this._logger.warn("Tried to deactivate sideline that is not active, this is a no-op.",{sidelineId:e})}_unpinSideline(e,t=!1){this._logger.debug("Unpinning sideline.",{sidelineId:e}),this._doesSidelineIdMatchRelevantSideline(e,this._pinnedSideline.get())?this._unpinSidelineSubs=this._sidelineCardActiveNotifications.pipe(m.h((t=>t===e)),f.q(1),v.h(!1),b.L(t?0:1e3,w.of(!0))).subscribe((t=>{t?(this._logger.debug("Did not receive notification that corresponding sideline card is active, proceeding to unpin sideline.",{sidelineId:e}),this._pinnedSideline.set(C.YP),this._deactivateSideline(e,!0)):this._logger.debug("Received a notification that corresponding sideline card is active, won't unpin sideline.",{sidelineId:e})})):this._logger.warn("Tried to unpin sideline that is not pinned, this is a no-op.",{sidelineId:e})}activateSideline(e){this._logger.debug("Activating sideline.",{sidelineId:e});const t=this._getSidelineById(e);C.pC(t)?(this._deactivateSidelineSubs.unsubscribe(),this._activeSideline.set(t),this._emphasizedSideline.set(t)):this._logger.warn("Tried to activate non-existing sideline, this is a no-op.",{sidelineId:e})}deactivateSideline(e){this._deactivateSideline(e)}pinSideline(e){this._logger.debug("Pinning sideline.",{sidelineId:e});const t=this._getSidelineById(e);C.pC(t)?(this._pinnedSideline.set(t),this.activateSideline(e)):this._logger.warn("Tried to pin non-existing sideline, this is a no-op.",{sidelineId:e})}unpinSideline(e){this._unpinSideline(e)}setSidelineReferenceElement(e,t){this._referenceElementBySidelineId.set(e,t)}getSidelineReferenceElement(e){return C.ij(this._referenceElementBySidelineId.get(e))}notifySidelineCardActive(e){this._sidelineCardActiveNotifications.next(e)}notifySidelineCardInactive(e,t){this._unpinSideline(e,t),this._deactivateSideline(e,t)}getSidelineById(e){return this._getSidelineById(e)}dispose(){this._subs.unsubscribe(),this._deactivateSidelineSubs.unsubscribe(),this._unpinSidelineSubs.unsubscribe()}}var E=i(7604),T=i(61292),k=i(46297);class F{constructor(e){this._params=e,this._subs=new n.w,this._logger=c.Y.create("G2IntegrationGoogleDocs"),this._textFieldDOMRectTopLeft=l.h.create({top:0,left:0,width:0,height:0}),this.name="g2-google-docs-integration",this.textFieldDOMRectTopLeft=this._textFieldDOMRectTopLeft.view(),this._subs.add(this._params.textFieldLayout.rect.behavior.pipe(a.U((e=>{const t=this._params.textFieldElement.querySelector(k.gv);if(null!==t){const{top:e,left:i,width:r,height:n}=t.getBoundingClientRect();return{top:e,left:i,width:r,height:n}}return this._logger.warn("Failed to retrieve canvas content element, defaulting to text field layout rect, which may not be appropriate as a text field DOM rect for documents with pages."),{top:e.client.top,left:e.client.left,...e.size}}))).subscribe(s.wW(this._textFieldDOMRectTopLeft)))}dispose(){this._subs.unsubscribe()}}var M=i(18431);const L={[M.u.gmailCompose]:22,[M.u.gmailReply]:22,[M.u.gmailComposeStandalone]:22,[M.u.gmailComposeFullScreen]:22,[M.u.slackMessage]:10,[M.u.slackGenericQuill]:10,[M.u.slackThread]:10};class G{constructor(e){this._params=e,this._subs=new n.w,this._logger=c.Y.create("G2IntegrationBase"),this._textFieldDOMRectTopLeft=l.h.create({top:0,left:0,width:0,height:0}),this.name="g2-base-integration",this.textFieldDOMRectTopLeft=this._textFieldDOMRectTopLeft.view(),this._subs.add(this._params.textFieldLayout.rect.behavior.pipe(a.U((e=>({top:e.client.top,left:e.client.left-this._getLeftOffset(),...e.size})))).subscribe(s.wW(this._textFieldDOMRectTopLeft)))}_getLeftOffset(){return this._params.integrationName in L?function(e){return L[e]}(this._params.integrationName):(this._logger.debug(`No left offset defined for integration with name "${this._params.integrationName}," defaulting to zero.`),0)}dispose(){this._subs.unsubscribe()}}var P=i(10389);var N=i(8125),A=i(22232),z=i(95195);const U={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let V;const B=new Uint8Array(16);function O(){if(!V&&(V="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!V))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return V(B)}const D=[];for(let e=0;e<256;++e)D.push((e+256).toString(16).slice(1));function Y(e,t=0){return D[e[t+0]]+D[e[t+1]]+D[e[t+2]]+D[e[t+3]]+"-"+D[e[t+4]]+D[e[t+5]]+"-"+D[e[t+6]]+D[e[t+7]]+"-"+D[e[t+8]]+D[e[t+9]]+"-"+D[e[t+10]]+D[e[t+11]]+D[e[t+12]]+D[e[t+13]]+D[e[t+14]]+D[e[t+15]]}const H=function(e,t,i){if(U.randomUUID&&!t&&!e)return U.randomUUID();const r=(e=e||{}).random||(e.rng||O)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){i=i||0;for(let e=0;e<16;++e)t[i+e]=r[e];return t}return Y(r)};var W,J=i(60797),j=i(66310),$=i(14717),q=i(73915),Q=i(59502),Z=i(59312);!function(e){e.Ideation="ideation",e.Rewrite="rewrite"}(W||(W={}));var X,K,ee,te,ie=i(83257),re=i(18164),ne=Le((function(e){return Me(ae(e),e.struct({}))(e)})),ae=Le((function(e){return e.intersect(e.partial({debugInfoJson:e.string}))(e.struct({id:e.number,correlationId:e.string}))})),se=Le((function(e){return Me(ae(e),e.struct({}))(e)})),le=(Le((function(e){return ye(e)})),Le((function(e){var t;return e.sum("valueType")(((t={}).string=de(e),t))}))),oe=Le((function(e){return e.struct({header:e.string,text:e.readonly(e.array(e.string))})})),de=Le((function(e){return e.intersect(e.partial({hint:oe(e)}))(e.struct({valueType:e.literal("string"),label:e.string,name:e.string}))})),ce=Le((function(e){return e.struct({id:e.string,label:e.string,args:e.readonly(e.array(le(e)))})})),he=Le((function(e){var t;return e.sum("kind")(((t={}).id=ue(e),t.label=pe(e),t))})),ue=Le((function(e){return e.struct({kind:e.literal("id"),value:e.string})})),pe=Le((function(e){return e.struct({kind:e.literal("label"),value:e.string})})),ge=Le((function(e){return e.struct({name:e.string,value:e.string})})),me=Le((function(e){var t;return e.sum("kind")(((t={}).predefinedAction=fe(e),t.userPrompt=ve(e),t))})),fe=Le((function(e){return e.intersect(e.partial({args:e.readonly(e.array(ge(e)))}))(e.struct({kind:e.literal("predefinedAction"),actionIdentifier:he(e)}))})),ve=Le((function(e){return e.struct({kind:e.literal("userPrompt"),value:e.string})})),be=(X=W,K=Object.keys(X).map((function(e){return X[e]})),ee=K[0],te=K.slice(1),Le((function(e){return e.literal.apply(e,(0,Z.ev)([ee],te,!1))}))),we=Le((function(e){return e.intersect(e.partial({trustResult:e.boolean}))(e.struct({}))})),Ce=Le((function(e){return e.intersect(e.partial({onApplyAcceptAlerts:e.readonly(e.array(e.number))}))(e.intersect(e.partial({onApplyIgnoreAlerts:e.readonly(e.array(e.number))}))(e.struct({})))})),_e=Le((function(e){return e.struct({start:e.number,end:e.number})})),Se=Le((function(e){return e.struct({promptsRemaining:e.number,promptsAllocated:e.number,refillDate:e.string})})),ye=Le((function(e){var t;return e.sum("action")(((t={})["disposable_cheetah:getActions"]=Re(e),t["disposable_cheetah:invokeCommand"]=Ie(e),t["disposable_cheetah:availableActions"]=xe(e),t["disposable_cheetah:resultSuccess"]=Ee(e),t["disposable_cheetah:partialResult"]=Te(e),t["disposable_cheetah:resultFailure"]=ke(e),t))})),Re=Le((function(e){return Me(ne(e),ae(e),e.intersect(e.partial({textScope:_e(e)}))(e.struct({action:e.literal("disposable_cheetah:getActions"),rev:e.number,generationMode:be(e)})))(e)})),Ie=Le((function(e){return Me(ne(e),ae(e),e.intersect(e.partial({textScope:_e(e)}))(e.intersect(e.partial({meta:we(e)}))(e.struct({action:e.literal("disposable_cheetah:invokeCommand"),rev:e.number,generationMode:be(e),command:me(e)}))))(e)})),xe=Le((function(e){return Me(ae(e),se(e),e.struct({action:e.literal("disposable_cheetah:availableActions"),actions:e.readonly(e.array(ce(e)))}))(e)})),Ee=Le((function(e){return Me(ae(e),se(e),e.struct({action:e.literal("disposable_cheetah:resultSuccess"),rewrittenText:e.string,rewrittenTextDelta:e.sensitiveDelta,usageLimits:Se(e),meta:Ce(e)}))(e)})),Te=Le((function(e){return Me(ae(e),se(e),e.struct({action:e.literal("disposable_cheetah:partialResult"),rewrittenText:e.string}))(e)})),ke=Le((function(e){return Me(ae(e),se(e),e.struct({action:e.literal("disposable_cheetah:resultFailure"),error:e.string}))(e)})),Fe=(Le((function(e){var t;return e.sum("action")(((t={})["disposable_cheetah:getActions"]=Re(e),t["disposable_cheetah:invokeCommand"]=Ie(e),t))})),Le((function(e){var t;return e.sum("action")(((t={})["disposable_cheetah:getActions"]=Re(e),t["disposable_cheetah:invokeCommand"]=Ie(e),t["disposable_cheetah:availableActions"]=xe(e),t["disposable_cheetah:resultSuccess"]=Ee(e),t["disposable_cheetah:partialResult"]=Te(e),t["disposable_cheetah:resultFailure"]=ke(e),t))})),Le((function(e){var t;return e.sum("action")(((t={})["disposable_cheetah:availableActions"]=xe(e),t["disposable_cheetah:resultSuccess"]=Ee(e),t["disposable_cheetah:partialResult"]=Te(e),t["disposable_cheetah:resultFailure"]=ke(e),t))})));function Me(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Le((function(t){return e.reduce((function(e,i){return t.intersect(i)(e)}))}))}function Le(e){return re.H(e)}(0,o.MZ)(q.n);ie.ov,ie.id(),ie.id(),ie.id(),ie.AG,ie.dt,ie.n_,ie.r$,ie.IM,ie.IX,ie.bc,ie.wf,ie.Sm,ie.OT;const Ge=q.n((Pe=Q.Schemable,function(e){return(0,Z.pi)((0,Z.pi)({},Pe),e)})({sensitiveDelta:Q.id()}))(Fe).is;var Pe;function Ne(e){return Ge(e)&&"disposable_cheetah:resultSuccess"===e.action}function Ae(e){return Ge(e)&&"disposable_cheetah:resultFailure"===e.action}function ze(e){return{kind:"predefinedAction",actionIdentifier:{kind:"id",value:e}}}function Ue(e){switch(e){case"improve":return ze("VBarG2DefaultRewrite");case"calliope":return ze("VBarG2Calliope");case"rephrase":return ze("VBarG2Paraphrase");case"shorten":return ze("VBarG2Shorter");case"friendly":return ze("VBarG2Friendly");case"formal":return ze("VBarG2Formal");default:(0,A.L0)(e)}}var Ve=i(69243);const Be=Ve.OT(Ve.dt({explanation:Ve.OT(Ve.Z_),vbar_type:Ve.OT(Ve.G0([Ve.i0("RED"),Ve.i0("YELLOW"),Ve.i0("GREEN")]))}));class Oe{constructor(e){this._params=e,this._subs=new n.w,this._logger=c.Y.create("RewriteServiceImpl"),this._relevantCapiMessages=this._params.checkingService.pipe(J.oA,j.w((e=>e.capiMessages)),m.h((0,N.Kg)(Ne,Ae))),this._cachedRewriteIdMap=new Map,this._cachedRewriteMap=new Map,this._subs.add(this._relevantCapiMessages.subscribe((e=>this._handleServerMessage(e))))}_handleServerMessage(e){Ne(e)?this._handleServerMessageResultSuccess(e):Ae(e)?this._handleServerMessageResultFailure(e):(0,A.L0)(e)}_handleServerMessageResultSuccess(e){const t=this._cachedRewriteMap.get(e.correlationId);if(void 0===t)this._logger.warn("Received a successful result with unknown correlation ID.",{resultSuccessMessage:e});else{const i=(0,o.zG)(function(e){if(void 0===e.debugInfoJson)return z.left("Debug info JSON undefined.");try{const t=JSON.parse(e.debugInfoJson);return(0,o.zG)(Be.decode(t),z.mapLeft((e=>"Failed to decode debug info JSON."+(e[0].message?`Reason: ${e[0].message}.`:""))))}catch(e){return z.left(`Failed to parse debug info JSON. Reason: ${e}.`)}}(e),z.mapLeft((e=>this._logger.error(`Failed to extract debug info from successful result. Reason: ${e}.`))),C.Uo),r={kind:"ready",id:t.get().id,type:t.get().type,text:t.get().text,textRange:t.get().textRange,title:(0,o.zG)(i,C.UI((e=>e.explanation)),C.pF((()=>{return"improve"===(e=t.get().type)?"Improve your text":"rephrase"===e?"Rephrase your text":"calliope"===e?"Refine your text":"shorten"===e?"Condense wordy sections":"friendly"===e?"Use a friendly tone":"formal"===e?"Use formal language":void(0,A.L0)(e);var e}))),color:(0,o.zG)(i,C.UI((e=>function(e){return"GREEN"==e.vbar_type?"green":"RED"===e.vbar_type?"red":"YELLOW"===e.vbar_type?"yellow":void(0,A.L0)(e.vbar_type)}(e))),C.pF((()=>{return"improve"===(e=t.get().type)?"red":"rephrase"===e||"calliope"===e||"formal"===e||"shorten"===e||"friendly"===e?"green":void(0,A.L0)(e);var e}))),rewriteText:e.rewrittenText,rewriteDelta:e.rewrittenTextDelta};this._logger.debug("Received a successful result; updating rewrite.",{rewriteBefore:t.get(),rewriteAfter:r}),t.set(r)}}_handleServerMessageResultFailure(e){const t=this._cachedRewriteMap.get(e.correlationId);if(void 0===t)this._logger.warn("Received a failed result with unknown correlation ID.",{resultFailureMessage:e});else{const i={kind:"error",id:t.get().id,type:t.get().type,text:t.get().text,textRange:t.get().textRange,errorReason:e.error};this._logger.debug("Received a failed result; updating rewrite.",{rewriteBefore:t.get(),rewriteAfter:i}),t.set(i)}}async getRewrite(e,t,i,r=!0){const n=(0,$.Wu)(t),a=`${e}-${i.start}-${i.end}-${n}`,s=this._cachedRewriteIdMap.get(a),o=void 0!==s?this._cachedRewriteMap.get(s):void 0,d=r&&void 0!==o&&"error"!==o.get().kind;if(d)return o;d||void 0===s||this._cachedRewriteMap.delete(s);const c=H();this._cachedRewriteIdMap.set(a,c);const h=l.h.create({kind:"loading",id:c,type:e,text:t,textRange:i});this._cachedRewriteMap.set(h.get().id,h);const u=this._params.checkingService.get();if(C.Wi(u))return this._logger.error("Failed to get rewrite. Checking service not initialized yet."),h.modify((e=>({...e,kind:"error",errorReason:"Failed to communicate with server."}))),h;const p=function(e){return{command:Ue(e.type),correlationId:e.id,generationMode:W.Rewrite,textScope:{start:e.textRange.start,end:e.textRange.end},debugInfoJson:JSON.stringify({trackBackendTimings:!0}),meta:{trustResult:!0}}}(h.get());try{const e=await u.value.sendMessage("disposable_cheetah:invokeCommand",p,!0,!1)();if(z.isLeft(e))throw e.left.message;return h}catch(e){return this._logger.error("Failed to get rewrite. Error sending  disposable_cheetah:invokeCommand message to CAPI.",{error:e}),h.modify((e=>({...e,kind:"error",errorReason:"Failed to communicate with server."}))),h}}dispose(){this._subs.unsubscribe()}}const De=r.lazy((()=>Promise.all([i.e(2251),i.e(6669),i.e(274)]).then(i.bind(i,81871)).then((({SidelineCard:e})=>({default:e})))));var Ye=i(62965),He=i(28043);function We(e){return"improve"===e}var Je=i(12126);var je=i(5957),$e=i(57757);class qe{constructor(e){var t;this._params=e,this._subs=new n.w,this._logger=c.Y.create("SidelineCardViewModelImpl"),this._visibleSidelineCard=l.h.create(C.YP),this._visibleSidelineCardSelectedRewriteType=l.h.create("improve"),this._visibleSidelineCardImproveRewriteInfo=l.h.create(C.G({kind:"idle",type:"improve"})),this._visibleSidelineCardRephraseRewriteInfo=l.h.create(C.G({kind:"idle",type:"rephrase"})),this._visibleSidelineCardCalliopeRewriteInfo=l.h.create(C.YP),this._visibleSidelineCardShortenRewriteInfo=l.h.create(C.YP),this._visibleSidelineCardFriendlyRewriteInfo=l.h.create(C.YP),this._visibleSidelineCardFormalRewriteInfo=l.h.create(C.YP),this.visibleSidelineCard=this._visibleSidelineCard.view(),this.visibleSidelineCardRewriteInfo=l.h.combine(this._visibleSidelineCardImproveRewriteInfo,this._visibleSidelineCardRephraseRewriteInfo,this._visibleSidelineCardCalliopeRewriteInfo,this._visibleSidelineCardShortenRewriteInfo,this._visibleSidelineCardFriendlyRewriteInfo,this._visibleSidelineCardFormalRewriteInfo,((e,t,i,r,n,a)=>({improve:e,rephrase:t,calliope:i,shorten:r,friendly:n,formal:a}))),this._subs.add((t=this._params.sidelineCollectionViewModel,g.aj([t.activeSideline,t.pinnedSideline]).pipe(a.U((([e,t])=>(0,o.zG)(t,C.UI((e=>({sideline:e,isPinned:!0}))),C.wp((()=>(0,o.zG)(e,C.UI((e=>({sideline:e,isPinned:!1}))))))))),a.U(C.tS((({sideline:e,isPinned:i})=>(0,o.zG)(t.getSidelineReferenceElement(e.id),C.UI((t=>({sidelineId:e.id,isSidelinePinned:i,referenceElement:t}))))))))).subscribe((e=>{this._resetVisibleSidelineCard(),(0,je.gw)(0).then((()=>this._visibleSidelineCard.set(e)))}))),this._subs.add(this._visibleSidelineCard.pipe(J.oA,j.w((e=>this._visibleSidelineCardSelectedRewriteType.pipe(a.U((t=>({visibleSidelineCard:e,visibleSidelineCardRewriteType:t})))))),j.w((({visibleSidelineCard:e,visibleSidelineCardRewriteType:t})=>function(e,t,i,r,n){return(0,o.zG)(e.getSidelineById(r.sidelineId),C.tS((e=>t.getParagraphById(e.paragraphId))),C.UI((e=>Je.D(i.getRewrite(n,e.text,e.textRange)).pipe(f.q(1),j.w(o.yR),a.U(C.G)))),C.pF((()=>w.of(C.YP))))}(this._params.sidelineCollectionViewModel,this._params.paragraphCollectionService,this._params.rewriteService,e,t).pipe(a.U((e=>({rewriteType:t,rewrite:e}))))))).subscribe((({rewriteType:e,rewrite:t})=>{switch(e){case"improve":this._visibleSidelineCardImproveRewriteInfo.set(t);break;case"calliope":this._visibleSidelineCardCalliopeRewriteInfo.set(t);break;case"rephrase":this._visibleSidelineCardRephraseRewriteInfo.set(t);break;case"shorten":this._visibleSidelineCardShortenRewriteInfo.set(t);break;case"friendly":this._visibleSidelineCardFriendlyRewriteInfo.set(t);break;case"formal":this._visibleSidelineCardFormalRewriteInfo.set(t);break;default:(0,A.L0)(e)}})));const i=this._visibleSidelineCardSelectedRewriteType.pipe(He.x(),m.h((r=We,function(e){return!r(e)})));var r;this._subs.add(i.subscribe((()=>{this._visibleSidelineCardCalliopeRewriteInfo.set(C.G({kind:"idle",type:"calliope"})),this._visibleSidelineCardShortenRewriteInfo.set(C.G({kind:"idle",type:"shorten"})),this._visibleSidelineCardFriendlyRewriteInfo.set(C.G({kind:"idle",type:"friendly"})),this._visibleSidelineCardFormalRewriteInfo.set(C.G({kind:"idle",type:"formal"}))})))}_resetVisibleSidelineCard(){this._visibleSidelineCard.set(C.YP),this._visibleSidelineCardRephraseRewriteInfo.set(C.G({type:"improve",kind:"idle"})),this._visibleSidelineCardRephraseRewriteInfo.set(C.G({type:"rephrase",kind:"idle"})),this._visibleSidelineCardCalliopeRewriteInfo.set(C.YP),this._visibleSidelineCardShortenRewriteInfo.set(C.YP),this._visibleSidelineCardFriendlyRewriteInfo.set(C.YP),this._visibleSidelineCardFormalRewriteInfo.set(C.YP),this._visibleSidelineCardSelectedRewriteType.set("improve")}activateSidelineCard(e){this._logger.debug("Activate sideline card.",{sidelineCard:e}),this._params.sidelineCollectionViewModel.notifySidelineCardActive(e.sidelineId)}deactivateSidelineCard(e){this._logger.debug("Deactivate sideline card.",{sidelineCard:e}),this._params.sidelineCollectionViewModel.notifySidelineCardInactive(e.sidelineId)}notifySelectedRewriteTypeChanged(e){this._logger.debug("Selected rewrite type changed.",{rewriteType:e}),this._visibleSidelineCardSelectedRewriteType.set(e)}applyRewrite(e,t){this._logger.debug("Apply rewrite.",{rewrite:e}),this._params.performReplacement({pos:e.textRange,value:e.rewriteText,oldValue:e.text}),this._params.sidelineCollectionViewModel.notifySidelineCardInactive(t.sidelineId,!0)}copyRewrite(e){return Ye.Y3((()=>(0,$e.vQ)(e.rewriteText)),z.toError)}dispose(){this._subs.unsubscribe()}}var Qe=i(3236),Ze=i(78674),Xe=i(93508);function Ke(e){let t=0,i=0;const r=[];for(;i<=e.length;)"\n"!==e.charAt(i)&&""!==e.charAt(i)||(t!==i&&r.push({start:t,end:i}),t=i+1),i++;return r}class et{constructor(e){this._params=e,this._subs=new n.w,this._paragraphs=l.h.create([]),this._paragraphById=new Map,this.paragraphs=this._paragraphs.view(),this._subs.add(this._params.textObserver.contentChanges.async.pipe(m.h((e=>!e.deltaChange.isEmpty)),Ze.b(1e3),Xe.O(null),a.U((()=>{const e=this._params.textObserver.getCurrentTextMap().getPlainText();return{paragraphTextRanges:Ke(e),fullText:e}})),a.U((({paragraphTextRanges:e,fullText:t})=>e.map((e=>({id:`g2-paragraph-${e.start}-${e.end}`,textRange:e,text:t.slice(e.start,e.end)})))))).subscribe(s.wW(this._paragraphs))),this._subs.add(this._paragraphs.subscribe((e=>{this._paragraphById.clear();for(const t of e)this._paragraphById.set(t.id,t)})))}getParagraphById(e){return C.ij(this._paragraphById.get(e))}dispose(){this._subs.unsubscribe()}}var tt=i(13718),it=i(19751),rt=i(14505),nt=i(62874),at=i(68435),st=i(52423);var lt=i(89456),ot=i(81964),dt=i(71249);class ct{constructor(e){this._params=e,this._subs=new n.w,this._logger=c.Y.create("ParagraphHighlightCollectionViewModelImpl"),this._paragraphHighlights=l.h.create([]),this._emphasizedParagraphHighlight=l.h.create(C.YP),this.paragraphHighlights=this._paragraphHighlights.view(),this.emphasizedParagraphHighlight=this._emphasizedParagraphHighlight.view(),this._subs.add(this._params.paragraphCollectionService.paragraphs.subscribe((e=>{const t=Array.from(this._params.highlightCollectionGeometry.geometry.get().keys());this._params.highlightCollectionGeometry.removeHighlights(t);for(const t of e){const e=E.y$.Id.create(`g2-paragraph-highlight-${t.textRange.start}-${t.textRange.end}`);this._params.highlightCollectionGeometry.addHighlight(e,t.textRange,{highlightId:e,alertId:t.id,highlightColor:null,highlightDisplayFormat:null,highlightLiveliness:null})}}))),this._subs.add(g.aj([this._params.integration.textFieldDOMRectTopLeft,this._params.textFieldLayout.rect.behavior.pipe(a.U((e=>e.client))),this._params.textFieldLayout.scroll.behavior,this._params.highlightCollectionGeometry.geometry.view((e=>Array.from(e.values())))]).pipe(a.U((([e,t,i,r])=>r.reduce(((r,n)=>((0,o.zG)(function(e,t,i,r,n,a){return(0,o.zG)(C.ij((0,at.jr)(i)),C.UI((i=>{const s=(0,st.Z)({kind:"offsetPoint",...i},r,n),l=s.left-a.left,o=a.left+a.width-s.right;return{id:e,paragraphId:t,textFieldRect:{top:i.top,left:i.left-l,width:i.width+l+o,height:i.height},viewportRect:{top:s.top,left:s.left-l,width:s.width+l+o,height:s.height}}})))}(n.meta.highlightId.toString(),n.meta.alertId,n.rects,t,i,e),C.g_((()=>{this._logger.warn("Failed to create paragraph highlight from highlight geometry. Skipping.",n)}),(e=>r.push(e)))),r)),[])))).subscribe(s.wW(this._paragraphHighlights))),this._subs.add(this._params.mouseData.pipe(tt.U(nt.S.hz30),it.skipBy(rt.Z.eq),a.U((({client:e,offset:t})=>{return i=this._paragraphHighlights.get(),r=e,n=t,a=this._params.textFieldElement,null!==r&&null!==n&&(0,ot._N)(r,a)?(0,o.zG)(i,dt.Ew((e=>lt.UL.contains(n,e.textFieldRect)))):C.YP;var i,r,n,a}))).subscribe(s.wW(this._emphasizedParagraphHighlight)))}dispose(){this._subs.unsubscribe()}}var ht=i(54951),ut=i(68006),pt=i(98017);class gt{constructor(e){this._params=e,this._subs=new n.w,this._logger=c.Y.create("G2FeatureImpl"),this._alertFilter=l.h.create(o.W8),this._integration=(0,T.a9)(this._params.integrationName)?new F({textFieldLayout:this._params.textFieldLayout,textFieldElement:this._params.textFieldElement}):new G({textFieldLayout:this._params.textFieldLayout,integrationName:this._params.integrationName}),this._rewriteService=new Oe({checkingService:this._params.checkingService}),this._paragraphCollectionService=new et({textObserver:this._params.textObserver}),this._highlightCollectionGeometry=new ht.C(this._params.geometryProvider,this._params.geometryLayout,(()=>this._params.textObserver.getCurrentTextMap()),(0,ut.u)(),(0,E.WF)(this._params.textFieldLayout),(0,pt.m)()),this._paragraphHighlightCollectionViewModel=new ct({paragraphCollectionService:this._paragraphCollectionService,highlightCollectionGeometry:this._highlightCollectionGeometry,textFieldLayout:this._params.textFieldLayout,mouseData:this._params.mouseData,textFieldElement:this._params.textFieldElement,integration:this._integration}),this._sidelineCollectionViewModel=new x({paragraphCollectionService:this._paragraphCollectionService,paragraphHighlightCollectionViewModel:this._paragraphHighlightCollectionViewModel,alerts:this._params.alertProcessor.alerts.state.view((e=>Object.values(e).filter(_.Nf).filter(d.S.isTransformJsonCapiAlert))),textObserver:this._params.textObserver}),this._replacementService=this._params.replacementServiceInjector.create(Qe.P.g2),this._sidelineCardViewModel=new qe({rewriteService:this._rewriteService,paragraphCollectionService:this._paragraphCollectionService,sidelineCollectionViewModel:this._sidelineCollectionViewModel,performReplacement:e=>this._replacementService.performReplacement(e)}),this.alertFilter=this._alertFilter.view(),this._logger.debug("G2 initialized on:",this._params.integrationName),this._subs.add(this._params.alertClassification.visibleInlineAlertsFilter.pipe(a.U((e=>t=>{return e(t)&&(i=t,d.S.isTransformJsonCapiAlert(i)&&i.outcome===P.TC.correctness&&i.transformJSON.highlights.every((e=>"enclosing"!==e.type)));var i}))).subscribe(s.wW(this._alertFilter)))}get paragraphHighlightsUI(){return r.createElement(r.Suspense,{fallback:r.createElement(r.Fragment,null)},r.createElement(h,{paragraphHighlights:this._paragraphHighlightCollectionViewModel.paragraphHighlights,activeSideline:this._sidelineCollectionViewModel.activeSideline,pinnedSideline:this._sidelineCollectionViewModel.pinnedSideline}))}get sidelinesUI(){return r.createElement(r.Suspense,{fallback:r.createElement(r.Fragment,null)},r.createElement(u,{sidelines:this._sidelineCollectionViewModel.sidelines,emphasizedSideline:this._sidelineCollectionViewModel.emphasizedSideline,activeSideline:this._sidelineCollectionViewModel.activeSideline,pinnedSideline:this._sidelineCollectionViewModel.pinnedSideline,onActivateSideline:e=>this._sidelineCollectionViewModel.activateSideline(e),onDeactivateSideline:e=>this._sidelineCollectionViewModel.deactivateSideline(e),onPinSideline:e=>this._sidelineCollectionViewModel.pinSideline(e),onUnpinSideline:e=>this._sidelineCollectionViewModel.unpinSideline(e),onMountSideline:(e,t)=>this._sidelineCollectionViewModel.setSidelineReferenceElement(e,t)}))}get sidelineCardUI(){return r.createElement(r.Suspense,{fallback:r.createElement(r.Fragment,null)},r.createElement(De,{visibleSidelineCard:this._sidelineCardViewModel.visibleSidelineCard,visibleSidelineCardRewriteInfo:this._sidelineCardViewModel.visibleSidelineCardRewriteInfo,onActivateSidelineCard:e=>this._sidelineCardViewModel.activateSidelineCard(e),onDeactivateSidelineCard:e=>this._sidelineCardViewModel.deactivateSidelineCard(e),onChangeSelectedRewriteType:e=>this._sidelineCardViewModel.notifySelectedRewriteTypeChanged(e),onApplyRewrite:(e,t)=>this._sidelineCardViewModel.applyRewrite(e,t),onCopyRewrite:e=>this._sidelineCardViewModel.copyRewrite(e)}))}dispose(){this._subs.unsubscribe(),this._integration.dispose(),this._rewriteService.dispose(),this._paragraphCollectionService.dispose(),this._highlightCollectionGeometry.dispose(),this._paragraphHighlightCollectionViewModel.dispose(),this._sidelineCollectionViewModel.dispose(),this._sidelineCardViewModel.dispose()}}},30494:(e,t,i)=>{i.r(t),i.d(t,{ParagraphHighlightCollection:()=>h});var r=i(5114),n=i(8543),a=i(23239),s=i(54001),l=i(57050),o=i(27378),d=i(41572),c=i(14711);const h=({paragraphHighlights:e,activeSideline:t,pinnedSideline:i})=>o.createElement(n.F.Fragment,null,a.h.combine(e,t,i,((e,t,i)=>o.createElement(d.L,{key:"g2",chunkName:"g2"},e.map((e=>{return o.createElement("div",{key:e.id,...(0,s.Sh)(c.paragraphHighlightRect,(n=e.paragraphId,a=(0,l.zG)(i,r.UI((e=>e.paragraphId))),d=(0,l.zG)(t,r.UI((e=>e.paragraphId))),(0,l.zG)(a,r.UI((e=>e===n)),r.wp((()=>(0,l.zG)(d,r.UI((e=>e===n))))),r.fS((()=>!1)))?c.paragraphHighlightRectActive:void 0)),style:{top:e.textFieldRect.top,left:e.textFieldRect.left,width:e.textFieldRect.width,height:e.textFieldRect.height}});var n,a,d}))))))},81871:(e,t,i)=>{i.r(t),i.d(t,{SidelineCard:()=>ee});var r=i(8543),n=i(27378),a=i(37869),s=i(17434);const l=({referenceElement:e,onMouseEnter:t,onMouseLeave:i,onFocus:r,onBlur:l,children:o})=>{const[d,c]=n.useState(null),{styles:h,attributes:u,state:p}=(0,a.D)(e,d,{placement:"bottom-start"});return n.createElement("div",{role:"dialog","aria-label":"Suggested rewrite dialog",tabIndex:0,ref:c,style:h.popper,className:s.sidelineCardPopper,onMouseEnter:t,onMouseLeave:i,onFocus:r,onBlur:l,...u.popper},o(null==p?void 0:p.placement))};var o=i(22232),d=i(73168);const c=()=>n.createElement("div",{className:d.sidelineCardRewriteLoadingSkeleton,"data-testid":"grammarly-g2-sideline-card-rewrite-loading-skeleton"},n.createElement("div",{className:d.sidelineCardRewriteLoadingSkeletonSignal}),n.createElement("div",{className:d.sidelineCardRewriteLoadingSkeletonContent},n.createElement("div",{className:d.sidelineCardRewriteLoadingSkeletonContentTitle}),n.createElement("div",{className:d.sidelineCardRewriteLoadingSkeletonContentText},n.createElement("div",{className:d.sidelineCardRewriteLoadingSkeletonContentTextLine}),n.createElement("div",{className:d.sidelineCardRewriteLoadingSkeletonContentTextLine}),n.createElement("div",{className:d.sidelineCardRewriteLoadingSkeletonContentTextLine}))));var h=i(6861),u=i(46354),p=i(40223),g=i(40938),m=i(98685);const f=({title:e,text:t})=>n.createElement("div",{className:h.sidelineCardRewriteSuccess,"data-testid":"grammarly-g2-sideline-card-rewrite-success"},n.createElement("div",{className:h.sidelineCardRewriteSuccessMain,"data-testid":"grammarly-g2-sideline-card-rewrite-success-main"},n.createElement(u.J,{size:"small",accessibilityLabel:"",icon:p.j}),n.createElement("div",{className:h.sidelineCardRewriteSuccessMainContent,"data-testid":"grammarly-g2-sideline-card-rewrite-success-main-content"},n.createElement(g.x,{className:h.sidelineCardRewriteSuccessMainContentTitle,as:"strong",color:"brand-default",variant:"text-small"},e),n.createElement(g.x,{as:"p",variant:"text-small",color:"base-subdued"},t))),n.createElement("div",{className:h.sidelineCardRewriteSuccessFooter,"data-testid":"grammarly-g2-sideline-card-rewrite-success-footer"},n.createElement(u.J,{size:"small",icon:m.p,accessibilityLabel:"Grammarly logo"})));var v=i(43043),b=i(54001),w=i(45552),C=i(31356),_=i(18657);const S=n.forwardRef((function(e,t){var i,r;const{buttonProps:a,isPressed:s,ref:l,inProgress:o,iconColor:d,variant:c}=(0,w.zT)(e,t),h=null!=(i=e.accessibilityLabel)?i:e.text,{isFocusVisible:p,focusProps:m}=(0,C.Fx)();let f=e.iconEnd,v=e.iconStart;"premium"===c&&(null!=e.iconEnd&&(f=_.O),null!=e.iconStart&&(v=_.O));const b="small"===e.size?"text-xsmall":"text-small";return n.createElement("button",{className:(0,w.gj)(e,s,o,p),tabIndex:null!=(r=e.tabIndex)?r:0,ref:l,...a,...m},null!=v&&n.createElement(u.J,{icon:v,accessibilityLabel:h,variant:d}),n.createElement(g.x,{as:"span",variant:b,weight:["primary","ghost","premium","critical"].includes(c)?"bold":"normal"},e.text),null!=f&&n.createElement(u.J,{icon:f,accessibilityLabel:h,variant:d}),null!=e.shortcut&&!["premium","critical"].includes(c)&&n.createElement(g.x,{variant:b,className:"gds-button-shortcut",as:"kbd"},e.shortcut))}));var y=i(95195),R=i(11559),I=i(77773),x=i(96833),E=i(57050),T=i(55649),k=i(35574);const F=e=>{const t=n.useRef(T.Y.create("SidelineCardRewriteCopyButton")),[i,r]=n.useState(!1),a=n.useRef(void 0),s=n.useCallback((()=>{void 0!==a.current&&(self.clearTimeout(a.current),a.current=void 0)}),[]);n.useEffect(s,[]);return n.createElement(R.k,{className:k.sidelineCardRewriteCopyButton},i&&n.createElement(R.k,{className:k.sidelineCardRewriteCopyButtonCopyConfirmation,bgColor:"background-base-default"},n.createElement(g.x,{as:"p",variant:"text-xsmall",color:"base-subdued"},"Copied")),n.createElement(I.h,{variant:"tertiary",accessibilityLabel:"Copy",icon:x.c,size:"small",onClick:async()=>{(0,E.zG)(await e.onClick(),y.match((e=>{t.current.error("Failed to copy rewrite.",e)}),(()=>{r(!0),s(),a.current=self.setTimeout((()=>{r(!1)}),3e3)})))}}))};function M(e){return"none"===e?void 0:"red"===e?v.sidelineCardRewriteReadyContentTitleRed:"purple"===e?v.sidelineCardRewriteReadyContentTitlePurple:"green"===e?v.sidelineCardRewriteReadyContentTitleGreen:"yellow"===e?v.sidelineCardRewriteReadyContentTitleYellow:(0,o.L0)(e)}const L=e=>{const[t,i]=n.useState(null);return n.createElement("div",{className:v.sidelineCardRewriteReady,"data-testid":"grammarly-g2-sideline-card-rewrite-ready"},n.createElement("div",{...(0,b.Sh)(v.sidelineCardRewriteReadySignal,(a=e.signalColor,"none"===a?void 0:"red"===a?v.sidelineCardRewriteReadySignalRed:"purple"===a?v.sidelineCardRewriteReadySignalPurple:"green"===a?v.sidelineCardRewriteReadySignalGreen:"yellow"===a?v.sidelineCardRewriteReadySignalYellow:(0,o.L0)(a))),"data-testid":"grammarly-g2-sideline-card-rewrite-ready-signal"}),n.createElement("div",{className:v.sidelineCardRewriteReadyContainer,"data-testid":"grammarly-g2-sideline-card-rewrite-ready-container"},n.createElement("div",{className:(r=null==t?void 0:t.getBoundingClientRect().height,r&&r>=190?v.sidelineCardRewriteReadyContentScrollable:v.sidelineCardRewriteReadyContent),"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content",ref:i},n.createElement(g.x,{...(0,b.Sh)(v.sidelineCardRewriteReadyContentTitle,M(e.signalColor)),as:"strong",variant:"text-small"},e.title),n.createElement(g.x,{as:"p",variant:"text-small"},e.newText)),n.createElement("div",{className:v.sidelineCardRewriteReadyContentToolbar,"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-toolbar"},n.createElement("div",{className:v.sidelineCardRewriteReadyContentToolbarLeft,"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-toolbar-left"},n.createElement(S,{variant:"tertiary",text:"apply"===e.applyCTA?"Accept":"Insert",shortcut:"⮐",size:"small",onClick:e.onApply,"data-testid":"apply"===e.applyCTA?"grammarly-g2-sideline-card-rewrite-ready-content-apply-btn":"grammarly-g2-sideline-card-rewrite-ready-content-insert-btn",className:v.sidelineCardRewriteReadyContentToolbarLeftActionBtn})),n.createElement("div",{className:v.sidelineCardRewriteReadyContentToolbarRight,"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-toolbar-right"},n.createElement(F,{onClick:e.onCopy}),n.createElement(u.J,{icon:m.p,accessibilityLabel:"Grammarly logo"})))));var r,a};var G=i(94504),P=i(12271);function N(e){switch(e){case"SENSITIVE_CONTENT":return["Assistance unavailable","Grammarly can't help with this due to potentially sensitive content. Try something different."];case"WRONG_REVISION":case"USER_TEXT_BLANK":case"NO_PROMPTS":case"UNKNOWN_CLIENT_REQUEST":case"EXCEPTION":return["Couldn’t generate ideas","Please wait a moment, then try again."];default:return[e,"Please wait a moment, then try again."]}}const A=({errorReason:e})=>n.createElement(R.k,{direction:"column",align:"center",gap:.5,padding:8,"data-testid":"grammarly-g2-sideline-card-rewrite-error"},n.createElement(u.J,{icon:G.F,size:"large",variant:"warning",accessibilityLabel:"","data-testid":"grammarly-g2-sideline-card-rewrite-error-icon"}),n.createElement(g.x,{as:"p",variant:"text-medium",color:"base-default",align:"center","data-testid":"grammarly-g2-sideline-card-rewrite-error-title"},(0,P.li)(N(e))),n.createElement(g.x,{as:"p",variant:"text-small",color:"base-subdued",align:"center","data-testid":"grammarly-g2-sideline-card-rewrite-error-subtitle"},(0,P.Yg)(N(e)))),z=e=>n.createElement("div",{role:"region","aria-live":"error"===e.kind?"assertive":"polite","aria-busy":"loading"===e.kind,"aria-label":U(e.kind),"data-testid":"grammarly-g2-sideline-card-rewrite"},(()=>{switch(e.kind){case"loading":return n.createElement(c,null);case"ready":return n.createElement(L,{signalColor:e.signalColor,title:e.title,originalText:e.originalText,newText:e.newText,applyCTA:e.applyCTA,onApply:e.onApply,onCopy:e.onCopy});case"success":return n.createElement(f,{title:e.title,text:e.text});case"error":return n.createElement(A,{errorReason:e.errorReason});default:(0,o.L0)(e)}})());function U(e){switch(e){case"loading":return"Loading suggested rewrite";case"ready":case"success":return"Suggested rewrite";case"error":return"An error occurred";default:(0,o.L0)(e)}}var V=i(50995),B=i(94768),O=i(51869),D=i(90308);const Y=n.createContext({selectedTab:"",setSelectedTab(){},focusedTab:"",setFocusedTab(){},onChange(){},tabIds:[""]}),H=e=>`gds-tab-${e}`,W=e=>`gds-tab-panel-${e}`;const J=n.forwardRef((function(e,t){const{bottomBorder:i="default"}=e,r=(0,B.B3)(t),{setSelectedTab:a,setFocusedTab:s,onChange:l,focusedTab:o,tabIds:d}=n.useContext(Y);return n.createElement("div",{ref:r,role:"tablist","aria-orientation":"horizontal","aria-label":e.accessibilityLabel,className:(0,O.W)("gds-tabs-list","none"===i&&"gds-tabs-border-none"),onKeyDown:e=>{const t=d.length,i=d.indexOf(o),r=e=>{var t;s(e),null==(t=document.getElementById(e))||t.focus()},n={ArrowRight:()=>{const e=d[(i+1)%t];r(e)},ArrowLeft:()=>{const e=d[(i-1+t)%t];r(e)},Enter:()=>{a(o),l(o)}}[e.key];n&&(e.preventDefault(),n())}},n.createElement(R.k,{gap:3,align:"end",style:{overflowX:"auto"}},e.children))})),j=n.forwardRef((function(e,t){const{selectedTab:i,setSelectedTab:r,setFocusedTab:a,onChange:s}=n.useContext(Y),l=H(e.id),o=W(e.id),d=(0,B.B3)(t),c=i===l;return n.createElement("button",{"aria-selected":c,"aria-controls":o,className:"gds-tabs-tab-container",id:l,ref:d,role:"tab",tabIndex:c?0:-1,onClick:()=>{r(l),a(l),s(l)}},n.createElement("div",{className:"gds-tabs-tab","data-text":e.label},n.createElement(g.x,{weight:c?"bold":"normal",as:"span",variant:"text-small"},e.label)))})),$=n.forwardRef((function(e,t){const{selectedTab:i}=n.useContext(Y),r=(0,B.B3)(t),a=H(e.id),s=W(e.id);let l=i===a;return n.useEffect((()=>{l=i===a}),[i]),l?n.createElement("div",{className:"gds-tabs-panel",role:"tabpanel",id:s,"aria-labelledby":a,ref:r,tabIndex:0},e.children):null})),q=(0,D.o)((e=>{const t=function(e){const t=[];return n.Children.forEach(e.children,(e=>{n.isValidElement(e)&&e.type===J&&n.Children.forEach(e.props.children,(e=>{n.isValidElement(e)&&e.type===j&&t.push(H(e.props.id))}))})),t}(e),{defaultSelectedTab:i,children:r}=e,a=i?H(i):t[0],[s,l]=n.useState(a),[o,d]=n.useState(a);return n.createElement("div",{className:"gds-tabs"},n.createElement(Y.Provider,{value:{selectedTab:s,setSelectedTab:l,setFocusedTab:d,onChange:t=>{e.onChange&&e.onChange(t.replace(/gds-tab-/,""))},focusedTab:o,tabIds:t}},r))}),"Tabs",{Panel:$,TabList:J,Tab:j}),Q=({shortenRewriteInfo:e,friendlyRewriteInfo:t,formalRewriteInfo:i})=>n.createElement(q.TabList,{accessibilityLabel:"Type of rewrite",bottomBorder:"none"},n.createElement(q.Tab,{id:"improve",label:"Improve"}),n.createElement(q.Tab,{id:"rephrase",label:"Rephrase"}),e&&n.createElement(q.Tab,{id:"shorten",label:"Shorten"}),t&&n.createElement(q.Tab,{id:"friendly",label:"Friendly"}),i&&n.createElement(q.Tab,{id:"formal",label:"Formal"})),Z=({improveRewriteInfo:e,rephraseRewriteInfo:t,shortenRewriteInfo:i,friendlyRewriteInfo:r,formalRewriteInfo:a})=>n.createElement(n.Fragment,null,n.createElement(q.Panel,{id:"improve"},n.createElement(z,{...e})),n.createElement(q.Panel,{id:"rephrase"},n.createElement(z,{...t})),i&&n.createElement(q.Panel,{id:"shorten"},n.createElement(z,{...i})),r&&n.createElement(q.Panel,{id:"friendly"},n.createElement(z,{...r})),a&&n.createElement(q.Panel,{id:"formal"},n.createElement(z,{...a}))),X=({tabListPosition:e,improveRewriteInfo:t,rephraseRewriteInfo:i,shortenRewriteInfo:r,friendlyRewriteInfo:a,formalRewriteInfo:s,onChangeSelectedRewriteType:l})=>{const o=n.createElement(Q,{shortenRewriteInfo:r,friendlyRewriteInfo:a,formalRewriteInfo:s}),d=n.createElement(Z,{improveRewriteInfo:t,rephraseRewriteInfo:i,shortenRewriteInfo:r,friendlyRewriteInfo:a,formalRewriteInfo:s});return n.createElement("div",{className:V.sidelineCard,"data-testid":"grammarly-g2-sideline-card"},n.createElement(q,{defaultSelectedTab:"improve",onChange:e=>l(e)},"top"===e?o:d,n.createElement("div",{className:V.sidelineCardHorizontalDivider}),"bottom"===e?o:d))};var K=i(5114);const ee=({visibleSidelineCard:e,visibleSidelineCardRewriteInfo:t,onActivateSidelineCard:i,onDeactivateSidelineCard:a,onChangeSelectedRewriteType:s,onApplyRewrite:d,onCopyRewrite:c})=>{const h=(e,t)=>(0,E.zG)(e,K.UI((e=>function(e,t,i){return"loading"===e.kind||"idle"===e.kind?{kind:"loading"}:"ready"===e.kind?e.text===e.rewriteText?{kind:"success",title:"This text looks great!",text:"To rephrase your text, select another option."}:{kind:"ready",title:e.title,signalColor:e.color,originalText:e.text,newText:e.rewriteText,applyCTA:"improve"===e.type?"apply":"insert",onApply:()=>t(e),onCopy:i(e)}:"error"===e.kind?{kind:"error",errorReason:e.errorReason}:void(0,o.L0)(e)}(e,(e=>d(e,t)),(e=>c(e))))));return n.createElement(r.F.Fragment,null,e.view((0,E.ls)(K.UI((e=>n.createElement(l,{referenceElement:e.referenceElement,onMouseEnter:()=>i(e),onMouseLeave:()=>{e.isSidelinePinned||a(e)},onFocus:()=>i(e),onBlur:()=>a(e)},(i=>n.createElement(r.F.Fragment,null,t.view((({improve:t,rephrase:r,shorten:a,friendly:l,formal:o})=>n.createElement(X,{tabListPosition:"bottom"===i||"bottom-end"===i||"bottom-start"===i?"top":"bottom",improveRewriteInfo:(0,E.zG)(h(t,e),K.pF((()=>({kind:"loading"})))),rephraseRewriteInfo:(0,E.zG)(h(r,e),K.pF((()=>({kind:"loading"})))),shortenRewriteInfo:(0,E.zG)(h(a,e),K.pF((()=>{}))),friendlyRewriteInfo:(0,E.zG)(h(l,e),K.pF((()=>{}))),formalRewriteInfo:(0,E.zG)(h(o,e),K.pF((()=>{}))),onChangeSelectedRewriteType:e=>s(e)})))))))),K.WG)))}},65211:(e,t,i)=>{i.r(t),i.d(t,{SidelineCollection:()=>v});var r=i(5114),n=i(8543),a=i(23239),s=i(57050),l=i(27378),o=i(41572),d=i(54001),c=i(38527),h=i(46354),u=i(80463),p=i(22232);const g=l.forwardRef((function({emphasized:e,signalColor:t,fillColor:i,height:r,onClick:n,onMouseOver:a,onMouseOut:s,onFocus:o,onBlur:g},m){return l.createElement("button",{"data-testid":"grammarly-g2-sideline",...(0,d.Sh)(c.sideline,e?c.sidelineEmphasized:c.sidelineIdle,"blue"===i?c.sidelineFillBlue:void 0),style:{height:r},disabled:!e,onClick:e?n:void 0,onFocus:e?o:void 0,onBlur:e?g:void 0,onMouseOver:a,onMouseOut:s,"aria-label":"See rewrite suggestions",ref:m},"none"!==t&&l.createElement("div",{...(0,d.Sh)(c.sidelineSignal,(e=>{switch(e){case"none":return;case"red":return c.sidelineSignalRed;case"purple":return c.sidelineSignalPurple;case"green":return c.sidelineSignalGreen;case"yellow":return c.sidelineSignalYellow;default:(0,p.L0)(e)}})(t),e&&c.sidelineSignalEmphasized),role:"status","aria-label":"Rewrite suggestions available"}),e&&l.createElement(h.J,{className:c.sidelineArrow,icon:u.b,accessibilityLabel:"",size:"small",variant:"none"!==i?"inverse":"default"}))}));var m=i(63954);function f(e,t,i,n){return(0,s.zG)(t,r.UI((t=>t===e.id)),r.fS((()=>(0,s.zG)(i,r.UI((t=>t===e.id)),r.fS((()=>!1)))||(0,s.zG)(n,r.UI((t=>t===e.id)),r.fS((()=>!1))))))}const v=({sidelines:e,emphasizedSideline:t,activeSideline:i,pinnedSideline:d,onActivateSideline:c,onDeactivateSideline:h,onPinSideline:u,onUnpinSideline:p,onMountSideline:v})=>l.createElement(n.F.Fragment,null,a.h.combine(e,t,i,d,((e,t,i,a)=>l.createElement(o.L,{key:"g2",chunkName:"g2"},e.map((e=>l.createElement(n.F.span,{key:e.id,className:m.sidelinePositioner,style:{top:e.viewportRect.top,left:e.viewportRect.left}},l.createElement(g,{fillColor:"none",emphasized:f(e,(0,s.zG)(a,r.UI((e=>e.id))),(0,s.zG)(i,r.UI((e=>e.id))),(0,s.zG)(t,r.UI((e=>e.id)))),signalColor:e.signalColor,height:e.viewportRect.height,onClick:()=>u(e.id),onFocus:()=>u(e.id),onBlur:()=>p(e.id),onMouseOver:()=>c(e.id),onMouseOut:()=>h(e.id),ref:t=>{t&&v(e.id,t)}}))))))))},46297:(e,t,i)=>{i.d(t,{$x:()=>s,F8:()=>g,Go:()=>n,Kt:()=>_,Lq:()=>d,Q2:()=>w,QR:()=>E,Qy:()=>v,Vk:()=>S,Wp:()=>r,XG:()=>a,_m:()=>u,d0:()=>c,f:()=>o,gH:()=>f,gL:()=>y,gv:()=>m,ij:()=>x,j5:()=>C,jW:()=>p,lO:()=>I,os:()=>b,rx:()=>R,uj:()=>h,y1:()=>l});const r=".kix-appview-editor",n=".docos-input",a=".docs-texteventtarget-iframe",s=".kix-cursor",l=".kix-cursor-caret",o="#docs-revisions-sidebar",d='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',c="#docs-toolbar-mode-switcher",h="edit-mode",u="suggest-mode",p="#titlebar-mode-indicator-container .titlebar-request-access-button",g="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",m=".kix-canvas-tile-content",f="canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)",v=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)",b=".kix-page-paginated.canvas-first-page",w="kix-page-canvas-compact-mode",C=".docs-horizontal-ruler",_=".docs-vertical-ruler",S="#fontSizeSelect input",y=".docs-ruler-background",R=".docs-ruler-background-inner",I=".docs-ruler-indent-first-line",x=".modal-dialog.docs-dialog .fatal-error-message",E='#docs-titlebar-share-client-button div[role="button"]'},18431:(e,t,i)=>{var r;i.d(t,{u:()=>r}),function(e){e.gmailReply="Gmail reply compose",e.gmailCompose="compose",e.gmailComposeStandalone="compose standalone",e.gmailComposeFullScreen="compose fullscreen",e.slackMessage="Slack Message",e.slackGenericQuill="Slack Generic Quill",e.slackThread="Slack Thread"}(r||(r={}))},57757:(e,t,i)=>{i.d(t,{Sz:()=>a,vQ:()=>n});var r=i(95195);async function n(e,t=self){if(function(e=self){var t,i;return!!(null===(i=null===(t=e.navigator)||void 0===t?void 0:t.clipboard)||void 0===i?void 0:i.writeText)}(t))return t.navigator.clipboard.writeText(e);throw new Error("Clipboard API not supported")}function a(e,t=self){return n(e,t).then((()=>r.right(void 0))).catch((e=>r.left(e instanceof Error?e:new Error(String(e)))))}},14717:(e,t,i)=>{function r(e,t=0){return(t<<5)-t+(0|e)|0}function n(e,t=0){let i=t;for(const t of e)i=r(t.charCodeAt(0),i);return i}i.d(t,{Wu:()=>n,k3:()=>r})},83257:(e,t,i)=>{i.d(t,{AG:()=>a,IM:()=>d,IX:()=>c,OT:()=>m,Sm:()=>p,Vo:()=>g,bc:()=>h,dt:()=>l,id:()=>v,n_:()=>s,ov:()=>b,qm:()=>w,r$:()=>o,wf:()=>u});var r=i(18164),n=i(57050);function a(e){return{encode:function(t){return null===t?null:e.encode(t)}}}function s(e){return{encode:function(t){var i={};for(var r in e)i[r]=e[r].encode(t[r]);return i}}}var l=s;function o(e){return{encode:function(t){var i={};for(var r in e){var n=t[r];r in t&&(i[r]=void 0===n?void 0:e[r].encode(n))}return i}}}function d(e){return{encode:function(t){var i={};for(var r in t)i[r]=e.encode(t[r]);return i}}}function c(e){return{encode:function(t){return t.map(e.encode)}}}function h(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return{encode:function(t){return e.map((function(e,i){return e.encode(t[i])}))}}}var u=function(e){return function(t){return{encode:function(i){return(0,r.U)(t.encode(i),e.encode(i))}}}};function p(e){return function(t){return{encode:function(i){return t[i[e]].encode(i)}}}}function g(e){var t=(0,r.H)(e);return{encode:function(e){return t().encode(e)}}}var m=n.yR,f=function(e,t){return{encode:function(i){return e.encode(t(i))}}};function v(){return{encode:n.yR}}var b="io-ts/Encoder",w={URI:b,contramap:f}},38527:e=>{e.exports={sideline:"G2vdT",sidelineEmphasized:"tw3gA",sidelineFillBlue:"ZsMnT",sidelineSignal:"E4ZA7",sidelineSignalRed:"NJZzh",sidelineSignalPurple:"bXbHB",sidelineSignalGreen:"sk2KB",sidelineSignalYellow:"qnAys",sidelineSignalEmphasized:"e4vte",sidelineArrow:"Ihuz1"}},50995:e=>{e.exports={sidelineCard:"KetZV",sidelineCardHorizontalDivider:"d96oB"}},17434:e=>{e.exports={sidelineCardPopper:"m2vlI"}},35574:e=>{e.exports={sidelineCardRewriteCopyButton:"_kIwY","5rem":"TE61X",sidelineCardRewriteCopyButtonCopyConfirmation:"eH5TV"}},73168:e=>{e.exports={sidelineCardRewriteLoadingSkeleton:"AZpqD",sidelineCardRewriteLoadingSkeletonSignal:"QmlkU",blink:"ME70b",sidelineCardRewriteLoadingSkeletonContent:"pCdaZ",sidelineCardRewriteLoadingSkeletonContentTitle:"njaNp",sidelineCardRewriteLoadingSkeletonContentText:"tFJmW",sidelineCardRewriteLoadingSkeletonContentTextLine:"CUydw"}},43043:e=>{e.exports={sidelineCardRewriteReady:"aC0Qq",sidelineCardRewriteReadySignal:"dwkGU",sidelineCardRewriteReadySignalRed:"j4c27",sidelineCardRewriteReadySignalPurple:"PAZPX",sidelineCardRewriteReadySignalGreen:"RQGEa",sidelineCardRewriteReadySignalYellow:"b0g8Y",sidelineCardRewriteReadyContainer:"JCAN0",sidelineCardRewriteReadyContentScrollable:"Cq6T4",sidelineCardRewriteReadyContent:"ANoVu",sidelineCardRewriteReadyContentTitle:"JruGr",sidelineCardRewriteReadyContentTitleRed:"u62sm",sidelineCardRewriteReadyContentTitlePurple:"O2bNp",sidelineCardRewriteReadyContentTitleGreen:"f5U00",sidelineCardRewriteReadyContentTitleYellow:"i_77I",sidelineCardRewriteReadyContentToolbar:"AkoCa",sidelineCardRewriteReadyContentToolbarLeft:"Fl51m",sidelineCardRewriteReadyContentToolbarLeftActionBtn:"s_g6E",sidelineCardRewriteReadyContentToolbarRight:"UPwBp"}},6861:e=>{e.exports={sidelineCardRewriteSuccess:"qCfRi",sidelineCardRewriteSuccessMain:"EHpcl",sidelineCardRewriteSuccessMainContent:"YnX7U",sidelineCardRewriteSuccessMainContentTitle:"KYYEg",sidelineCardRewriteSuccessFooter:"mKGH0"}},14711:e=>{e.exports={paragraphHighlightRect:"gvgre",paragraphHighlightRectActive:"oE69j"}},63954:e=>{e.exports={sidelinePositioner:"lx6ct"}},80463:(e,t,i)=>{i.d(t,{b:()=>n});var r=i(27378);const n=(0,i(91961).I)("color",(({title:e,titleId:t,desc:i,descId:n,...a})=>r.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16","aria-hidden":"true",stroke:"transparent","aria-labelledby":t,"aria-describedby":n,...a},i?r.createElement("desc",{id:n},i):null,e?r.createElement("title",{id:t},e):null,r.createElement("path",{stroke:"#646B81",strokeLinecap:"round",d:"m2 5 6 6 6-6"}))))}}]);