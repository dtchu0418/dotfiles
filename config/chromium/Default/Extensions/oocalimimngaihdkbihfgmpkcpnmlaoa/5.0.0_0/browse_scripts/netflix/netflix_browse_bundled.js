/*******************************************************
* Copyright (C) 2018-2024 WP Interactive Media, Inc. - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
*******************************************************/
(()=>{var t={7588:()=>{!function(t,e,n){"use strict";if(t.MutationObserver&&"undefined"!=typeof HTMLElement){var i,o=0,r=(i=HTMLElement.prototype.matches||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector,{matchesSelector:function(t,e){return t instanceof HTMLElement&&i.call(t,e)},addMethod:function(t,e,n){var i=t[e];t[e]=function(){return n.length==arguments.length?n.apply(this,arguments):"function"==typeof i?i.apply(this,arguments):void 0}},callCallbacks:function(t,e){e&&e.options.onceOnly&&1==e.firedElems.length&&(t=[t[0]]);for(var n,i=0;n=t[i];i++)n&&n.callback&&n.callback.call(n.elem,n.elem);e&&e.options.onceOnly&&1==e.firedElems.length&&e.me.unbindEventWithSelectorAndCallback.call(e.target,e.selector,e.callback)},checkChildNodesRecursively:function(t,e,n,i){for(var o,s=0;o=t[s];s++)n(o,e,i)&&i.push({callback:e.callback,elem:o}),o.childNodes.length>0&&r.checkChildNodesRecursively(o.childNodes,e,n,i)},mergeArrays:function(t,e){var n,i={};for(n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);for(n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);return i},toElementsArray:function(e){return void 0===e||"number"==typeof e.length&&e!==t||(e=[e]),e}}),s=function(){var t=function(){this.t=[],this.i=null,this.o=null};return t.prototype.addEvent=function(t,e,n,i){var o={target:t,selector:e,options:n,callback:i,firedElems:[]};return this.i&&this.i(o),this.t.push(o),o},t.prototype.removeEvent=function(t){for(var e,n=this.t.length-1;e=this.t[n];n--)if(t(e)){this.o&&this.o(e);var i=this.t.splice(n,1);i&&i.length&&(i[0].callback=null)}},t.prototype.beforeAdding=function(t){this.i=t},t.prototype.beforeRemoving=function(t){this.o=t},t}(),c=function(e,i){var o=new s,c=this,u={fireOnAttributesModification:!1};return o.beforeAdding((function(n){var o,r=n.target;r!==t.document&&r!==t||(r=document.getElementsByTagName("html")[0]),o=new MutationObserver((function(t){i.call(this,t,n)}));var s=e(n.options);o.observe(r,s),n.observer=o,n.me=c})),o.beforeRemoving((function(t){t.observer.disconnect()})),this.bindEvent=function(t,e,n){e=r.mergeArrays(u,e);for(var i=r.toElementsArray(this),s=0;s<i.length;s++)o.addEvent(i[s],t,e,n)},this.unbindEvent=function(){var t=r.toElementsArray(this);o.removeEvent((function(e){for(var i=0;i<t.length;i++)if(this===n||e.target===t[i])return!0;return!1}))},this.unbindEventWithSelectorOrCallback=function(t){var e,i=r.toElementsArray(this),s=t;e="function"==typeof t?function(t){for(var e=0;e<i.length;e++)if((this===n||t.target===i[e])&&t.callback===s)return!0;return!1}:function(e){for(var o=0;o<i.length;o++)if((this===n||e.target===i[o])&&e.selector===t)return!0;return!1},o.removeEvent(e)},this.unbindEventWithSelectorAndCallback=function(t,e){var i=r.toElementsArray(this);o.removeEvent((function(o){for(var r=0;r<i.length;r++)if((this===n||o.target===i[r])&&o.selector===t&&o.callback===e)return!0;return!1}))},this},u=new function(){var t={fireOnAttributesModification:!1,onceOnly:!1,existing:!1};function e(t,e,i){return!(!r.matchesSelector(t,e.selector)||(t.u===n&&(t.u=o++),-1!=e.firedElems.indexOf(t.u)))&&(e.firedElems.push(t.u),!0)}var i=(u=new c((function(t){var e={attributes:!1,childList:!0,subtree:!0};return t.fireOnAttributesModification&&(e.attributes=!0),e}),(function(t,n){t.forEach((function(t){var i=t.addedNodes,o=t.target,s=[];null!==i&&i.length>0?r.checkChildNodesRecursively(i,n,e,s):"attributes"===t.type&&e(o,n,s)&&s.push({callback:n.callback,elem:o}),r.callCallbacks(s,n)}))}))).bindEvent;return u.bindEvent=function(e,n,o){void 0===o?(o=n,n=t):n=r.mergeArrays(t,n);var s=r.toElementsArray(this);if(n.existing){for(var c=[],u=0;u<s.length;u++)for(var a=s[u].querySelectorAll(e),l=0;l<a.length;l++)c.push({callback:o,elem:a[l]});if(n.onceOnly&&c.length)return o.call(c[0].elem,c[0].elem);setTimeout(r.callCallbacks,1,c)}i.call(this,e,n,o)},u},a=new function(){var t={};function e(t,e){return r.matchesSelector(t,e.selector)}var n=(a=new c((function(){return{childList:!0,subtree:!0}}),(function(t,n){t.forEach((function(t){var i=t.removedNodes,o=[];null!==i&&i.length>0&&r.checkChildNodesRecursively(i,n,e,o),r.callCallbacks(o,n)}))}))).bindEvent;return a.bindEvent=function(e,i,o){void 0===o?(o=i,i=t):i=r.mergeArrays(t,i),n.call(this,e,i,o)},a};e&&h(e.fn),h(HTMLElement.prototype),h(NodeList.prototype),h(HTMLCollection.prototype),h(HTMLDocument.prototype),h(Window.prototype);var l={};return f(u,l,"unbindAllArrive"),f(a,l,"unbindAllLeave"),l}function f(t,e,n){r.addMethod(e,n,t.unbindEvent),r.addMethod(e,n,t.unbindEventWithSelectorOrCallback),r.addMethod(e,n,t.unbindEventWithSelectorAndCallback)}function h(t){t.arrive=u.bindEvent,f(u,t,"unbindArrive"),t.leave=a.bindEvent,f(a,t,"unbindLeave")}}(window,"undefined"==typeof jQuery?null:jQuery,void 0)}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}(()=>{"use strict";const t="Service_Background",e="Content_Script";var i;!function(t){t[t.CHROME=1]="CHROME",t[t.FIREFOX=2]="FIREFOX",t[t.EDGE=4]="EDGE",t[t.SAFARI=8]="SAFARI"}(i||(i={}));i.CHROME;const o="Failed to read chrome storage. Please refresh the page and try again";var r=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{u(i.next(t))}catch(t){r(t)}}function c(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}u((i=i.apply(t,e||[])).next())}))};const s=new class{getItemAsync(t){return r(this,void 0,void 0,(function*(){return(yield chrome.storage.local.get(t))[t]}))}getItemsAsync(t){return r(this,void 0,void 0,(function*(){return new Promise(((e,n)=>{chrome.storage.local.get(t,(t=>{chrome.runtime.lastError?(console.log(chrome.runtime.lastError),n(new Error(o))):e(t)}))}))}))}getStorageUse(){return r(this,void 0,void 0,(function*(){return new Promise(((t,e)=>{chrome.storage.local.getBytesInUse(null,(n=>{chrome.runtime.lastError?(console.log(chrome.runtime.lastError),e(new Error(o))):t(n)}))}))}))}getAllItemsAsync(){return r(this,void 0,void 0,(function*(){return new Promise(((t,e)=>{chrome.storage.local.get(null,(n=>{chrome.runtime.lastError?(console.log(chrome.runtime.lastError),e(new Error(o))):t(n)}))}))}))}};Object.freeze(s);const c=s;var u=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{u(i.next(t))}catch(t){r(t)}}function c(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}u((i=i.apply(t,e||[])).next())}))};const a=new class{setItemsAsync(t){return u(this,void 0,void 0,(function*(){return new Promise(((e,n)=>{chrome.storage.local.set(t,(()=>{chrome.runtime.lastError?n(new Error("Failed to write to chrome storage. Please refresh the page and try again")):e()}))}))}))}};Object.freeze(a);const l=a;const f=chrome.runtime.id,h=(chrome.runtime.getManifest().version,["crunchyroll","funimation","paramount","peacock","hotstar","starplus","espn","appletv","jiocinema","mubi","stan","crave","sling","fubo","viki"]);var d=console.log.bind(self.console),v=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{u(i.next(t))}catch(t){r(t)}}function c(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}u((i=i.apply(t,e||[])).next())}))};const m=new class{addListener(t){chrome.runtime.onMessage.addListener(t),chrome.runtime.onMessage.addListener(t)}removeListener(t){chrome.runtime.onMessage.removeListener(t)}sendMessageToTabAsync(t,e,n=2e4){return v(this,void 0,void 0,(function*(){return new Promise(((i,o)=>{const r=setTimeout((()=>{console.log("send timeout"),o("Message Timeout")}),n);try{chrome.tabs.sendMessage(e,t,(e=>{chrome.runtime.lastError&&d(chrome.runtime.lastError.message+JSON.stringify(t)),clearTimeout(r),i(e)}))}catch(t){clearTimeout(r),o(t)}}))}))}l(t,e){return v(this,void 0,void 0,(function*(){return new Promise(((n,i)=>{let o=null;e&&(o=setTimeout((()=>{i({error:"Send Message Timeout"})}),e));try{chrome.runtime.sendMessage(f,t,(e=>{chrome.runtime.lastError&&console.log(chrome.runtime.lastError.message+JSON.stringify(t)),o&&clearTimeout(o),n(e)}))}catch(t){o&&clearTimeout(o),i(t)}}))}))}};class w{constructor(t,e,n){this.sender=t,this.target=e,this.type=n}}class g extends w{constructor(t,e,n){super(t,e,n),this.type=n}}var p;!function(t){t.JOIN_SESSION="joinSession",t.ACCEPT_DROPIN="acceptDropin",t.SET_STATUS_TYPE="setStatusType",t.SET_DATA="setData",t.GET_DATA="getData",t.GET_STATUS_TYPE="getStatusType",t.GET_VIDEO_DATA="getVideoData",t.LOAD_SESSION="loadSession",t.NO_SESSION_DATA="noSessionData",t.ON_NOTIF="onNotif",t.FORWARD_TO_SIDEBAR="forwardToSidebar",t.TEARDOWN="teardown",t.ON_VIDEO_UPDATE="onVideoUpdate",t.SOCKET_LOST_CONNECTION="socketLostConnection",t.REBOOT="socketReconnect",t.LOG_EVENT="logEvent",t.LOG_EXPERIMENT="logExperiment",t.STAY_ALIVE="stayAlive",t.LOAD_CHAT_WINDOW="loadChatWindow",t.RESET_CHAT_WINDOW="resetChatWindow",t.HIDE_CHAT_WINDOW="hideChatWindow",t.SET_USER_PRESENCE="setUserPresence",t.TOGGLE_OPEN_PARTY="toggleOpenParty",t.GET_ACTIVE_PARTY="getActiveParty",t.GET_TAB_ID="getTabId",t.SET_ACTIVE_PARTY="setActiveParty",t.FULLSCREEN_WINDOW="fullscreenWindow",t.MAX_WINDOW="maxWindow",t.GET_EXPERIMENT_FLAG="getExpFlag",t.USER_LIST="userList",t.USER_AUTHENTICATED="userAuthenticated",t.BLOCK_CSP="blockCSP",t.REDIRECT_DATA_SET="redirectDataSet",t.LOAD_NETFLIX_DATA="loadNetflixData"}(p||(p={}));class y extends g{constructor(t,e,n){super(t,e,p.LOG_EVENT),this.data=n,this.sender=t,this.target=e}}var S,b;function T(t){const e=document.createElement("script");e.setAttribute("tpInjected",""),e.src=t,(document.head||document.documentElement).appendChild(e),e.remove()}!function(t){t.REGISTER="register",t.PARTY_START="party_start",t.PARTY_JOIN="party_join",t.PARTY_END="party_end",t.PARTY_SHARE="party_share"}(S||(S={})),function(t){t.NETFLIX="Netflix",t.HULU="Hulu",t.DISNEY_PLUS="Disney",t.DISNEY_PLUS_MENA="DisneyMena",t.HBO_MAX="HBOMax",t.MAX="Max",t.YOUTUBE="Youtube",t.YOUTUBE_TV="YoutubeTV",t.AMAZON="Amazon",t.CRUNCHYROLL="Crunchyroll",t.ESPN="ESPN+",t.PARAMOUNT="Paramount+",t.FUNIMATION="Funimation",t.HOTSTAR="Hotstar",t.PEACOCK="peacock",t.STAR_PLUS="Starplus",t.PLUTO_TV="PlutoTV",t.APPLE_TV="AppleTV",t.JIO_CINEMA="JioCinema",t.TUBI_TV="TubiTV",t.MUBI="Mubi",t.STAN="Stan",t.CRAVE="Crave",t.SLING="slingtv",t.FUBO="fubo",t.VIKI="viki",t.SPOTIFY="spotify",t.NATIVE_VIKI="native_party_Viki"}(b||(b={}));class M{constructor(){this.h=this.v.bind(this),this.m=[],this.p()}addMessageListener(t){this.m.push(t)}removeMessageListener(t){this.m=this.m.filter((t=>{}))}p(){m.addListener(this.h)}teardown(){this.m=[],m.removeListener(this.h)}v(t,e,n){if(!this.S(t))return!1;return!!this.T(t,e,n)||(n({}),!1)}S(t){return t.target===e}T(t,e,n){let i=!1;return this.m.forEach((o=>{o.onMessage(t,e,n)&&(i=!0)})),i}}var E;n(7588);!function(t){t.CREATE_SESSION="createSession",t.RE_INJECT="reInject",t.GET_INIT_DATA="getInitData",t.GET_INIT_USER_SETTINGS="getInitUserSettings",t.IS_CONTENT_SCRIPT_READY="isContentScriptReady",t.SET_CHAT_VISIBLE="setChatVisible",t.DISCONNECT="teardown",t.CLOSE_POPUP="closePopup",t.GET_SCHEDULED_EVENTS="getScheduledEvents",t.GET_RECENT_SCHEDULED_EVENTS="getRecentScheduledEvents",t.GOOGLE_SIGN_IN="googleSignIn",t.EMAIL_SIGN_IN="emailSignIn",t.FORGOT_PASSWORD="forgotPassword",t.EMAIL_SIGN_UP="emailSignUp",t.ON_GOOGLE_SIGN_IN="OnGoogleSignIn",t.CREATE_SCHEDULED_EVENT="createScheduledEvent",t.DELETE_SCHEDULED_EVENT="deleteScheduledEvent",t.SET_USER_STATUS="SET_USER_STATUS",t.SIGN_IN_CREATE="SIGN_IN_CREATE",t.REDIRECT_DATA_SET="redirectDataSet"}(E||(E={}));class L extends w{constructor(t,e,n){super(t,e,n),this.type=n}}class P extends L{constructor(t,e){super(t,e,E.GET_INIT_USER_SETTINGS)}}var _=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{u(i.next(t))}catch(t){r(t)}}function c(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}u((i=i.apply(t,e||[])).next())}))};class A{constructor(t,e){this.h=new M,this.h.addMessageListener(this),this.serviceName=t,this.colloquialServiceName=e,this.M(),this.L(),this.P()}isLoggingIn(){return!1}L(){return _(this,void 0,void 0,(function*(){const e=yield m.l(new P("Popup",t));h.includes(this.serviceName)&&!(null==e?void 0:e.has_premium)||this._()}))}_(){T(chrome.runtime.getURL(`browse_scripts/${this.serviceName}/${this.serviceName}_browse_injected_bundled.js`))}M(){chrome.runtime.connect().onMessage.addListener((()=>{console.log("Ping received")}))}P(){return _(this,void 0,void 0,(function*(){}))}onMessage(t,e,n){return!0}}class I extends A{constructor(){super("netflix",b.NETFLIX)}isLoggingIn(){if(window.location.href.includes("/login"))return!0;const t=document.querySelector("button[data-uia='homepage-link-button']");if("JOIN NOW"===(null==t?void 0:t.textContent))return!0;const e=document.querySelector("a[data-uia='header-login-link']");return"Sign In"===(null==e?void 0:e.textContent)}}var x,D=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{u(i.next(t))}catch(t){r(t)}}function c(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}u((i=i.apply(t,e||[])).next())}))};if(!(window.teleparty&&(null===(x=window.teleparty)||void 0===x?void 0:x.browseScriptInjected)||window!==top)){window.teleparty||(window.teleparty={}),window.teleparty.browseScriptInjected=!0,new I;{const n=()=>D(void 0,void 0,void 0,(function*(){const t=(yield c.getItemsAsync(["NDL"])).NDL;(null==t||Date.now()-t>121e7)&&window.postMessage({type:"tpLoadNetflixData",lastFetch:t},"*")}));window.addEventListener("message",(i=>{if("tpNetflixBrowseReady"===i.data.type&&n(),"tpSetNetflixData"===i.data.type){const n=i.data.data,o=n.deviceList,r=[];o.forEach((t=>{const e=new Date(t.lastWatched).getTime();r.push(Object.assign(Object.assign({},t),{lastWatchedTimeStamp:e}))}));const s=new Map,c=new Set;n.watchHistoryList.forEach((t=>{t.watchHistory.forEach((t=>{let e=-1,n=!1;for(let i=0;i<r.length;i++){const o=r[i];Math.abs(t.date-o.lastWatchedTimeStamp)<6e4&&(-1===e?e=i:n=!0)}if(-1!==e&&!n){const n=r[e].deviceDescription;s.has(t.deviceType)&&s.get(t.deviceType)!==n?(c.add(t.deviceType),s.delete(t.deviceType)):c.has(t.deviceType)||s.set(t.deviceType,r[e].deviceDescription)}}))}));const u={name:"netflix_device_list",data:{device_json:o}};m.l(new y(e,t,u));const a=n.watchHistoryList;let f=0;a.forEach((t=>{t.watchHistory.forEach((t=>{t.deviceDescription=s.get(t.deviceType)})),f=Math.max(f,t.watchHistory.length)}));const h=new g(e,t,p.LOAD_NETFLIX_DATA);h.data=a,m.l(h),l.setItemsAsync({NDL:Date.now()})}}))}}})()})();