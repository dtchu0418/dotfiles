/*******************************************************
* Copyright (C) 2018-2024 WP Interactive Media, Inc. - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
*******************************************************/
(()=>{"use strict";var t,e=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function c(t){try{s(i.next(t))}catch(t){r(t)}}function a(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}s((i=i.apply(t,e||[])).next())}))};function n(){return e(this,void 0,void 0,(function*(){var t=[];try{const o=yield fetch("https://www.netflix.com/manageaccountaccess"),r=yield o.text();for(var e=(new DOMParser).parseFromString(r,"text/html").querySelectorAll(".device-list-item"),n=0;n<e.length;n++){var i={};i.deviceDescription=e[n].querySelector("h2").innerText,i.lastWatched=e[n].querySelector(".last-watched").innerText,i.profileName=e[n].querySelector(".profile-name").innerText,t.push(i)}}catch(t){return}return t}))}function i(t=0){return e(this,void 0,void 0,(function*(){try{let n=[];const i=yield fetch("https://www.netflix.com/YourAccount"),o=yield i.text(),r=(new DOMParser).parseFromString(o,"text/html");let c=[];return r.querySelectorAll(".profile-link[href*='viewed'").forEach((t=>{c.push(t.href.split("viewed/")[1])})),yield Promise.all(c.map((i=>e(this,void 0,void 0,(function*(){const o=[];let r;const c=t?50:1e4,a=(n=0)=>e(this,void 0,void 0,(function*(){try{const e=yield fetch(`https://www.netflix.com/api/shakti/mre/viewingactivity?pg=${n}&pgsize=${c}&guid=${i}`),s=yield e.json();i=s.profileInfo.guid,r=s.profileInfo.profileName;let l=s.viewedItems.filter((e=>e.date>t));if(o.push(...l),s.viewedItems.length==c&&l.length===s.viewedItems.length)return yield a(n+1)}catch(t){}}));yield a(),n.push({guid:i,profileName:r,watchHistory:o})}))))),n}catch(t){return}}))}if(!window.tpBrowseInjected){window.tpBrowseInjected=!0,t=function(){if(null!=document.getElementById("native-party-button"))return;const t=document.querySelector("a.primary-button.playLink");if(null==t)return;const e=t.parentElement,n=document.createElement("button");n.setAttribute("style","background: linear-gradient(273.58deg, #9E55A0 0%, #EF3E3A 100%); color: #fff; border-style: none; border-radius: 0.375rem; padding: 1.1rem; display: flex; align-items: center; justify-content: center; max-height: 45px;"),n.setAttribute("id","native-party-button"),n.setAttribute("class","hasLabel");const i=document.querySelector("a.primary-button.playLink span"),o=document.createElement("span");return o.innerText="Start a Teleparty",o.setAttribute("style","line-height: 1.7rem; font-size: 1.4rem; text-wrap: nowrap"),o.setAttribute("class",i.getAttribute("class")),e.insertBefore(n,t.nextSibling),n.appendChild(o),[{button:n,play:()=>t.click()}]},setInterval((()=>{try{const e=t();if(e)for(const t of e)t.button.addEventListener("click",(()=>{localStorage.setItem("nativeParty",JSON.stringify({shouldStart:!0,expiry:Date.now()+12e4,randomId:Math.random().toString()})),t.play(),t.button.removeEventListener("click",(()=>{}))}))}catch(t){}}),500),window.postMessage({type:"tpNetflixBrowseReady"},"*");{const t=t=>e(void 0,void 0,void 0,(function*(){const[e,o]=yield Promise.all([n(),i(t)]);window.postMessage({type:"tpSetNetflixData",data:{deviceList:e,watchHistoryList:o}},"*")}));window.addEventListener("message",(e=>{if("tpLoadNetflixData"===e.data.type){const n=e.data.lastFetch;t(n)}}))}}})();